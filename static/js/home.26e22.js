"use strict";(self.webpackChunkrunmy=self.webpackChunkrunmy||[]).push([["home"],{"./src/js/main/index.tsx":function(e,s,t){t.r(s),t.d(s,{default:function(){return De}});var a=t("./node_modules/react/index.js"),i=t("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=t("./node_modules/@s-ekin/web/lib/index.js"),r=t("./src/js/util/utilfn.ts"),l=t("./node_modules/react/jsx-runtime.js");const c=e=>{const s=[];return e.map((e=>{const{id:t}=e,a=t.split(","),i=a[a.length-1];"TianMen"==i?s.push("tianmen"):"HuiZhou"==i?s.push("huizhou"):["driveCar","train"].includes(i)?s.push("car"):["run","gym","walk","rope"].includes(i)?s.push("sport"):"void"==i?s.push("quiclly"):["colleagues","friends"].includes(i)?s.push("eat"):["landscope","shopping","hall"].includes(i)&&s.push("play")})),s},o=({node:e,index:s,parNode:t,isOld:a,parIndex:i})=>{const c=t?t.id+"-"+String(s):e.id,o=t||e,d=(0,r.lq)(e.id),h=d?(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("span",{className:"progress",children:[(0,l.jsxs)("span",{className:"tit",children:[" ",e.progress.join("/")]}),(0,l.jsxs)("span",{className:"add",children:["(",e.add,")"]})]})}):(0,l.jsx)("span",{className:"progress",children:(0,l.jsxs)("span",{className:"tit",children:[" ",e.progress[0]]})}),m=o.txt.split("-");m.splice(0,1);const p=(0,r.q7)(o.id,o.type||o.children[0].type),u=(0,l.jsx)("td",{className:"main-td",rowSpan:t?t.children.length:void 0,colSpan:t?void 0:2,children:(0,l.jsxs)("div",{className:"subject-item",children:[(0,l.jsx)("span",{className:"sub-num",children:i?i+1:s+1}),o.again&&!t?(0,l.jsx)("span",{className:"again",children:(0,r.aK)(+o.again-1)}):null,(0,l.jsx)("span",{className:`icon-type ${p}`,children:(0,l.jsx)(n.SvgIcon,{className:p})}),(0,l.jsx)("span",{className:"item-name",children:m.join("-")}),t?null:h]})});return(0,l.jsxs)("tr",{children:[t?0===s?u:void 0:u,t?(0,l.jsxs)("td",{children:[(0,l.jsxs)("span",{className:"order",children:[s+1,"、"]}),e.again?(0,l.jsx)("span",{className:"again",children:(0,r.aK)(+e.again-1)}):null,e.txt,h]}):void 0,a?(0,l.jsx)("td",{align:"center",children:(0,l.jsx)("span",{className:"add",children:e.add})}):d||(0,r.LT)(e.type)?(0,l.jsxs)("td",{children:[(0,l.jsx)("div",{className:"flex-center",children:e.taskNum.map(((s,t)=>(0,l.jsx)("div",{className:"time-cell",children:(0,l.jsxs)("span",{className:"add",children:[d&&s||"",(0,l.jsxs)("span",{className:"time-tip",children:[(0,l.jsx)("span",{children:e.taskStartTime[t]}),(0,l.jsx)("span",{className:"hour-val",children:e.taskHour[t]?`${e.taskHour[t]}`:""})]})," "]})},t)))}),(0,l.jsx)("p",{className:"item-remark",children:e.taskStartTime[3]||""})]}):(0,l.jsxs)("td",{children:[(0,l.jsxs)("span",{className:"time-tip",children:[e.taskStartTime[0]?`${e.taskStartTime[0]}/${e.taskHour[0]||""}`:""," "]}),(0,l.jsxs)("span",{className:"time-tip",children:[" ",e.taskStartTime[1]?`${e.taskStartTime[1]}/${e.taskHour[1]||""}`:""]}),(0,l.jsx)("p",{className:"item-remark",children:e.taskStartTime[2]})]})]},c)},d=({node:e,isOld:s,initScroll:t})=>{const[i,d]=(0,a.useState)(!1);if(e.get("none"))return(0,l.jsx)(l.Fragment,{});const{remark:h,task:m,timeInfo:p,status:u,dayTime:x}=e.toJS();let j="";const g=s?e.get("playTime"):(0,r.KX)(p),f=m.reduce(((e,s)=>["101","204","301","408"].includes(s.id.slice(0,3))?(s.children?e+=s.children.reduce(((e,s)=>e+s.taskHour.reduce(((e,s)=>e+Number(s)),0)),0):e+=s.taskHour.reduce(((e,s)=>e+Number(s)),0),e):e),0);return(0,l.jsx)("div",{children:(0,l.jsxs)("table",{className:"taskInfo-tab log-tab",children:[(0,l.jsxs)("colgroup",{children:[(0,l.jsx)("col",{}),(0,l.jsx)("col",{width:"25%"}),(0,l.jsx)("col",{width:s?"20%":"43.5%"})]}),(0,l.jsxs)("thead",{className:"log",children:[(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{colSpan:2,children:(0,l.jsxs)("div",{className:"log-bar",children:[(0,l.jsx)(n.Switch,{change:()=>{d((e=>!e)),t()},checked:i}),(0,l.jsx)("span",{children:"浪费："}),(0,l.jsx)("span",{className:"waster",children:g}),(0,l.jsx)("span",{children:"学习:"}),(0,l.jsx)("span",{className:"erergy-box",children:(0,l.jsx)(n.SvgIcon,{className:f<2?"energy-0":f<6?"energy-15":f<9?"energy-55":f<12?"energy-80":"energy",size:"big"})}),(0,l.jsx)("span",{className:"study",children:f.toFixed(1)}),(0,l.jsx)("span",{children:"工作："}),(0,l.jsx)("span",{className:"work",children:p[3]}),c(m).map((e=>(0,l.jsx)("span",{className:"habit-icon",children:(0,l.jsx)(n.SvgIcon,{className:e,size:"middle"})},e))),u?(0,l.jsx)("span",{className:"status-icon",children:(0,l.jsx)(n.SvgIcon,{className:u,size:"big"})}):null]})}),s?(0,l.jsx)("th",{children:"完成量"}):(0,l.jsx)("th",{children:(0,l.jsx)("div",{className:"flex-center",children:p.slice(0,3).map(((e,s)=>(0,l.jsxs)("div",{className:"time-cell",children:[["早","中","晚"][s],(0,l.jsxs)("span",{className:"waster-time",children:[e||0,"h"]}),(0,l.jsxs)("span",{children:[" ",x[s]]})]},s)))})})]}),(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:3,children:(0,l.jsx)("p",{className:"txt-remark",children:h})})})]}),(0,l.jsx)("tbody",{children:m.map(((e,t)=>{const{children:n,txt:c,id:d}=e,h=(0,r.lq)(d);if(!i&&!h)return(0,l.jsx)(l.Fragment,{});let p;const u=d.split(",");if(u[0]!==j){let e=null;if(s)e="";else{let s=0;m.slice(t).some((e=>{if(e.id.split(",")[0]!=u[0])return!0;e.children?e.children.map((e=>{s+=(0,r.xI)(e.taskHour,{id:e.id,type:e.type})})):s+=(0,r.xI)(e.taskHour,{id:e.id,type:e.type})})),e=s?(0,l.jsxs)("span",{children:["：",Number(s.toFixed(1))]}):null}p=(0,l.jsx)("tr",{className:"theme",children:(0,l.jsxs)("td",{colSpan:3,children:[c.split("-")[0],e]})}),j=u[0]}else p=null;let x;return x=n?n.map(((a,i)=>(0,l.jsx)(o,{isOld:s,node:a,index:i,parIndex:t,parNode:e},a.id))):(0,l.jsx)(o,{isOld:s,node:e,index:t}),(0,l.jsxs)(a.Fragment,{children:[p,x]},e.id)}))})]})})},h=n.timeFn.getCurTime(),m=["日","一","二","三","四","五","六"],p=[{id:-10,text:"-10月"},{id:-11,text:"-11月"},{id:-12,text:"-12月"}];class u extends a.PureComponent{constructor(...e){super(...e),(0,i.Z)(this,"state",{month:h.month,monthArr:this.getMons(!1),data:[],isOld:!1,hasDefault:!0}),(0,i.Z)(this,"dayTask",(e=>(0,l.jsx)(d,{initScroll:this.initScroll,isOld:this.state.isOld,node:e}))),(0,i.Z)(this,"initScroll",(()=>{this.setState((e=>({data:e.data.concat(),hasDefault:!1})))})),(0,i.Z)(this,"changeMonth",(e=>{const s=+e[0].id,t=this.state.isOld?1:0;this.setState({data:this.createDayData(this.props.logs[t],s),month:s,hasDefault:!0})})),(0,i.Z)(this,"dayTime",((e,s)=>{const t=this.state.month===h.month&&h.day===Number(s)?"today":"",a=((e,s,t)=>{const a=new Date(s>0?e:e-1,Math.abs(s)-1,1).getDay();return m[(a+t-1)%7]})(this.state.isOld?h.year-1:h.year,this.state.month,+s),i=["日","六"].includes(a)?" weekends":"";return(0,l.jsxs)("span",{className:t+i,children:[s.padStart(2,"0"),(0,l.jsxs)("span",{children:["(",a,")"]})]})})),(0,i.Z)(this,"search",(e=>{this.setState((s=>{const t=this.state.isOld?1:0;return{data:this.createDayData(this.props.logs[t],s.month).map((s=>{const t=s.task.filter((s=>{const{children:t}=s,a=s.txt.includes(e);return!a&&t?(s.children=t.filter((s=>s.txt.includes(e))),s.children.length):a}));s.task=t;const a=new RegExp(e,"g");return s.remark=s.remark.includes(e)?s.remark.replace(a,`【${e}】`):"",s}))}}))})),(0,i.Z)(this,"closeSearch",(()=>{this.setState((e=>({data:this.createDayData(this.props.logs[Number(!e.isOld)],e.month)})))})),(0,i.Z)(this,"switchFn",(()=>{this.setState((e=>({isOld:!e.isOld,monthArr:this.getMons(!e.isOld)})),(()=>{this.setState((()=>({data:this.createDayData(this.props.logs[Number(this.state.isOld)],this.state.month)})))}))}))}createDayData(e,s){const t=Math.abs(s),a=this.state.isOld?h.year-1:h.year,i=new Date(s<1?a-1:a,t,0).getDate();return new Array(i).fill("1").map(((t,a)=>{const i=a+1,n=e[`${s}-${i}`],l=n?this.state.isOld?n.playTime:(0,r.KX)(n.timeInfo):"";return{id:String(i),playTime:l,task:n?n.task:[],remark:n&&n.remark||"",timeInfo:n?n.timeInfo||void 0:[],status:n?n.status:void 0,dayTime:(null==n?void 0:n.dayTime)||["","",""],none:!n}}))}getData(e){const{logs:s}=this.props,t=this.state.isOld?1:0;this.setState({data:this.createDayData(s[t],e)})}componentDidMount(){this.getData(this.state.month)}componentDidUpdate(e){if(this.props.logs!==e.logs){const e=this.state.isOld?1:0;this.setState({data:this.createDayData(this.props.logs[e],this.state.month)})}}getMons(e){const s=new Array(e?12:h.month).fill("").map(((e,s)=>({id:s+1,text:`${s+1}月`})));return e?p.concat(s).reverse():s.reverse()}render(){const{month:e,data:s,isOld:t,monthArr:a,hasDefault:i}=this.state;return(0,l.jsxs)(n.Table,{idField:"id",noPageNums:!0,data:s,noOrder:!0,defaultSel:i?String(h.day>1?h.day-1:h.day):void 0,children:[(0,l.jsx)(n.Table.colItem,{align:"center",width:80,field:"month",formatter:this.dayTime,children:(0,l.jsx)(n.Combobox,{data:a,width:60,noIcon:!0,noSearch:!0,dropWidth:100,defaultVal:String(e),field:"month",clickCallback:this.changeMonth})}),(0,l.jsx)(n.Table.colItem,{field:"txt",formatter:this.dayTask,children:(0,l.jsxs)("div",{className:"opt-box",children:[(0,l.jsx)(n.Search,{field:"filter",width:400,searchHandle:this.search,closeHandle:this.closeSearch,children:"完成任务"}),(0,l.jsx)(n.Switch,{change:this.switchFn,tit:"新,旧",checked:!t})]})})]})}}var x=u,j=t("./src/api/main.tsx"),g=t("./node_modules/react-router/dist/index.js"),f=t("./node_modules/echarts/index.js");const v=n.timeFn.getCurTime();var N=({logs:e})=>{const s=(0,a.useRef)(null),t=(0,a.useRef)(),i={color:["red","blue","green","#B1D0E0"],areaColor:[["rgba(128, 255, 165,0.05)","rgba(128, 255, 165, 0.65)"],[],["rgba(255, 71, 101,0.05)","rgba(255, 71, 101,0.65)"],[],[]]};return(0,a.useEffect)((()=>{const a=["time","task","oldTime","oldTask","work"],n=a.map(((e,s)=>({type:i.areaColor[s].length||4===s?"line":"bar",color:i.color[s],step:4===s?"end":void 0,smooth:!0,name:e,itemStyle:{borderRadius:[8,8,0,0]},showSymbol:!1,lineStyle:{width:4===s?1.5:.5,opacity:4===s?1:.75,shadowColor:"rgba(0, 0, 0, 0.85)",shadowBlur:10},lable:{show:!0,color:"red",position:"top"},markLine:"time"!=e?void 0:{data:[{yAxis:-2,name:"玩",label:{show:!0,color:"#b17063"},symbolSize:[3,4],lineStyle:{type:"dotted",color:"#b17063",width:1}},{yAxis:-8,name:"废了",symbolSize:[3,4],label:{show:!0,color:"red"},lineStyle:{type:"solid",color:"red",width:1}}]},areaStyle:i.areaColor[s].length?{color:new f.Q.o(0,0,0,1,[{offset:0,color:i.areaColor[s][0]},{offset:1,color:i.areaColor[s][1]}])}:void 0}))),l=new Date;l.setDate(1);const c=l.getDay(),o=new Array(v.month).fill("").map(((e,s)=>`${s+1}月`)),d=o.map(((s,t)=>{const a=t+1,i=new Date(v.year,Math.abs(a),0).getDate(),n=[],l=[],o=[],d=[],h=[],m=new Array(i).fill("").map(((s,t)=>{const i=`${a}-${t+1}`,m=e[0][i]||{playTime:0,task:[],timeInfo:[0,0,0,0]},p=e[1][i]||{playTime:0,task:[]};n.push((0,r.KX)(m.timeInfo)),l.push(p.playTime),o.push(p.task.length),d.push(m.timeInfo?+m.timeInfo[3]:0);const u=i===`${v.month}-${v.day}`,x=(c+t)%7,j=0===x||6===x,g={value:`${t+1}`,textStyle:{color:j?"#579BB1":void 0,fontWeight:u||j?"bold":void 0,fontSize:u?16:13}};return h.push(g),m.task.reduce(((e,s)=>(0,r.lq)(s.id)?e+1:e),0)}));return{series:[{data:n.map((e=>-e))},{data:m},{data:l.map((e=>-e))},{data:o},{data:d}],xAxis:{data:h,show:!0}}})),h={timeline:{axisType:"category",autoPlay:!1,currentIndex:v.month-1,playInterval:4e3,data:o},animation:!0,legend:{show:!0,data:a,top:5},tooltip:{show:!0,trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{show:!1,data:[]},yAxis:[{type:"value"}],grid:{bottom:70,top:36,left:40,right:25},series:n,options:d};t.current||(t.current=f.S1(s.current)),t.current.setOption(h)}),[e]),(0,l.jsx)("div",{className:"sumarize",ref:s})};class y extends a.PureComponent{constructor(...e){super(...e),(0,i.Z)(this,"state",{}),(0,i.Z)(this,"slecteSubject",(e=>{e.stopPropagation();const s=e.currentTarget.dataset.path,t=(0,r.Fz)(this.props.subjectData,s);this.props.selectSubject(t)})),(0,i.Z)(this,"treeTit",(e=>{const s=e.get("type"),t=e.get("children").size,a=(0,r.q7)(`${e.get("id")}`,s);return(0,l.jsxs)("span",{className:"tit","data-path":e.get("path"),onClick:this.slecteSubject,children:[t?void 0:(0,l.jsx)("span",{className:`icon-type ${a}`,children:(0,l.jsx)(n.SvgIcon,{className:a})}),e.get("tit"),"1"==e.get("again")?(0,l.jsxs)("span",{children:[" ",(0,l.jsx)(n.SvgIcon,{className:"finishTask"})]}):void 0]})})),(0,i.Z)(this,"timeRender",((e,s,t,a)=>{const{forecast:i,actual:n}=e.toJS();return{"forecast-start":i[0],"forecast-end":i[1],"actual-start":n[0],"actual-end":n[1]}[a]})),(0,i.Z)(this,"viewProgress",(e=>{const s=e.currentTarget.dataset.path,t=(0,r.Fz)(this.props.subjectData,s);(0,r.iL)(t.node.type)&&this.props.selectSubject(t,!0)})),(0,i.Z)(this,"progressFn",(e=>(0,l.jsx)("span",{"data-path":e.get("path"),className:"progress-txt "+(e.get("children").size?"":"progress-file"),onClick:e.get("children").size?void 0:this.viewProgress,children:e.get("progress")})))}render(){const{subjectData:e}=this.props;return(0,l.jsx)("div",{className:"course-tab",children:(0,l.jsxs)(n.TreeTable,{idField:"id",itemIcon:!1,data:e,noexpand:!0,children:[(0,l.jsx)(n.TreeGroupCols,{forzen:!0,children:(0,l.jsx)(n.TreeGroupCols.colItem,{field:"tit",width:240,formatter:this.treeTit,children:(0,l.jsx)("div",{className:"subject-tit",children:(0,l.jsx)("span",{children:"科目"})})})}),(0,l.jsxs)(n.TreeGroupCols,{children:[(0,l.jsx)(n.TreeGroupCols.colItem,{field:"lastTime",align:"center",width:70,children:"上次"}),(0,l.jsx)(n.TreeGroupCols.colItem,{field:"sum",align:"center",width:60,children:"总数"}),(0,l.jsx)(n.TreeGroupCols.colItem,{align:"center",field:"progress",width:70,formatter:this.progressFn,children:"进度"}),(0,l.jsx)(n.TreeGroupCols.colItem,{align:"center",field:"hour",width:70,children:"用时"}),(0,l.jsx)(n.TreeGroupCols.colItem,{align:"center",field:"actual-start",formatter:this.timeRender,width:70,children:"实开"}),(0,l.jsx)(n.TreeGroupCols.colItem,{align:"center",field:"actual-end",formatter:this.timeRender,width:70,children:"实结"}),(0,l.jsx)(n.TreeGroupCols.colItem,{align:"center",field:"forecast-end",formatter:this.timeRender,width:70,children:"预结"})]})]})})}}var b=y,S=t("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js");const k=["id"];function w(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);s&&(a=a.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,a)}return t}function T(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?w(Object(t),!0).forEach((function(s){(0,i.Z)(e,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}))}return e}const C=n.timeFn.getCurTime();class I extends a.PureComponent{constructor(...e){super(...e),(0,i.Z)(this,"state",{}),(0,i.Z)(this,"boxRef",(0,a.createRef)()),(0,i.Z)(this,"chartInstance",null)}componentDidMount(){this.chartInstance=f.S1(this.boxRef.current),this.init(this.props.lastWeek)}getChartData(e,s){return s.map((s=>{const t=s.split(","),{play:a,taskArr:i,work:n}=(0,r.u4)(t[0],t[1],e[0]),l={301:i[1],101:i[3],408:i[2],204:i[0]},{play:c,taskArr:o}=(0,r.u4)(t[0],t[1],e[1]),d={"-301":-o[1],"-101":-o[3],"-408":-o[2],"-204":-o[0]};return T(T({id:s,play:a||0,old:c?-c:0,work:n},l),d)}))}init(e){const{logs:s}=this.props;this.chartInstance.setOption(this.createChart(s,e))}componentDidUpdate(e){e.logs===this.props.logs&&e.lastWeek===this.props.lastWeek||this.init(this.props.lastWeek)}createChart(e,s){const t=((e=0)=>{const s=[];let t=new Date,a=t.getDay();a=a||7,t.setDate(t.getDate()-7*e-a+1);let i=t.getDate();return new Array(7).fill("").map((()=>{s.push(`${t.getMonth()+1},${t.getDate()}`),i=t.getDate()+1,t.setDate(i)})),s})(s),a={},i={301:"#91CC75",204:"#5470C6",408:"#FACE6C",101:"#EE6666","-301":"#91CC75","-204":"#5470C6","-408":"#FACE6C","-101":"#EE6666"},n=this.getChartData(e,t).map((e=>{const{id:s}=e,t=(0,S.Z)(e,k);Object.keys(t).map((e=>{a[e]=a[e]||(["play","old","work"].includes(e)?{type:"line",smooth:!0,showSymbol:!1,color:"play"===e?"red":"work"===e?"#3A98B9":"#f5af19",yAxisIndex:0,step:"work"===e?"end":void 0,lineStyle:{width:"work"===e?2.5:.5,opacity:.75,shadowColor:"rgba(0, 0, 0, 0.85)",shadowBlur:10},data:[],name:e,areaStyle:"work"===e?void 0:{color:new f.Q.o(0,0,0,1,[{offset:0,color:"paly"===e?"rgba(255, 70, 131,0.05)":"rgba(255, 128, 68,0.05)"},{offset:1,color:"play"===e?"rgba(255, 70, 131,0.65)":"rgba(215, 128, 68,0.65)"}])}}:{type:"bar",itemStyle:{borderRadius:6},data:[],name:e,stack:"value",barWidth:20});const s=t[e],n={value:s,label:{show:!("bar"!==a[e].type||0==Number(s)),position:"inside",fontWeight:"bold",color:"white"},itemStyle:{color:i[e]}};a[e].data.push(n)}));const n=s.replace(",","-"),r=n===`${C.month}-${C.day}`;return{value:n,textStyle:{color:r?"blue":void 0,fontSize:13,fontWeight:r?"bold":void 0}}})),{tit:r}=this.props;return{xAxis:{data:n,show:!0},title:r?{text:r,top:10,left:14,textStyle:{color:"一战"!==r?"#873bf4":"red"}}:void 0,legend:{show:!1,data:Object.keys(a),top:10,right:10,width:140,height:30,itemWidth:12,itemHeight:10,padding:[0,5],itemGap:5},tooltip:{show:!0,trigger:"axis",axisPointer:{type:"shadow",label:{show:!1}},formatter:e=>`<p class="chart-tip-day">${e[0].name}</p><div class="chart-tip-box">\n        <p class="item"><span class="txt"> 英语</span><span class="new">${e[1].value}</span><span class="old"> ${-e[10].value}</span></p>\n        <p class="item"><span class="txt"> 数学</span><span class="new">${e[2].value}</span><span class="old">${-e[7].value}</span></p>\n        <p class="item"><span class="txt"> 计算机</span><span class="new">${e[3].value}</span><span class="old">${-e[9].value}</span></p>\n        <p class="item"><span class="txt"> 政治</span><span class="new">${e[0].value}</span><span class="old">${-e[8].value}</span></p>\n        <p class="item"><span class="txt"> 浪费</span><span class="new">${e[4].value}</span><span class="old">${-e[5].value}</span></p>\n        <p class="item"><span class="txt">工作</span><span class="new">${e[6].value}</span></p>\n        </div>\n        `},yAxis:[{type:"value",nameTextStyle:{padding:[0,30,0,0],color:"blue",fontWeight:"bolder",fontSize:14}}],grid:{bottom:30,top:20,left:40,right:20},series:Object.values(a)}}render(){return(0,l.jsx)("div",{className:"week-chart-box",children:(0,l.jsx)("div",{className:"chart",ref:this.boxRef})})}}var F=I,$=t("./node_modules/react-router-dom/dist/index.js");const D=n.timeFn.getCurTime(),A=(0,r.w0)(`1/1/${D.year}`,`${D.month}/${D.day}/2023`),O=(0,r.w0)(`1/1/${D.year}`,`12/24/${D.year}`),H=()=>{const e=(0,a.useRef)(0),[s,t]=(0,a.useState)(0);return(0,a.useEffect)((()=>{const s=window.setInterval((()=>{e.current=e.current+1,t(e.current),e.current>=A&&clearInterval(s)}),28);return()=>{clearInterval(s)}}),[]),(0,l.jsxs)("div",{className:"day-box",children:[(0,l.jsxs)("div",{className:"rest-time",children:["已过",(0,l.jsx)("span",{className:"has-days days",children:String(s).padStart(3,"0")}),"天"]}),(0,l.jsxs)("div",{className:"rest-time",children:["只有",(0,l.jsx)("span",{className:"rest-days days",children:String(O-s).padStart(3,"0")}),"天"]})]})};var P=()=>(0,l.jsxs)("div",{className:"opt-box",children:[(0,l.jsx)("div",{children:(0,l.jsx)("span",{className:"task-handle",children:(0,l.jsx)($.OL,{to:"home/allot",children:(0,l.jsx)(n.SvgIcon,{className:"task",size:"big"})})})}),(0,l.jsxs)("div",{className:"today-box",children:[(0,l.jsxs)("span",{className:"tit",children:["今天 ",(0,l.jsx)("br",{}),D.month,".",D.day]}),(0,l.jsx)("span",{style:{padding:"0 6px"}}),(0,l.jsx)(H,{})]}),(0,l.jsx)("div",{children:(0,l.jsx)($.OL,{to:"home/logs",children:(0,l.jsx)(n.SvgIcon,{className:"time",size:"big"})})})]});const q=n.timeFn.getCurTime();var Z=({month:e,logs:s,course:t})=>{const i=(0,a.useRef)(null),[c,o]=(0,a.useState)([]),[d,h]=(0,a.useState)([]),m=(0,r.pl)(e),p=(0,a.useMemo)((()=>{const e=[{},{}],s=(t,a)=>{a=a+""+(a?"-":""),t.map((t=>{if(t.children.length)s(t.children,a+t.tit);else{const{forecast:s}=t;s.map(((s,i)=>{s.split("-")[0]===String(q.month)&&(e[i][s]=e[i][s]||[],e[i][s].push(Object.assign({},t,{tit:a+t.tit})))}))}}))};return s(t,""),e}),[t]),u=(0,a.useCallback)((e=>{const s=e.currentTarget.dataset.time,t=p[0][s]||[],a=p[1][s]||[];h([t,a])}),[t]),x=(t,a)=>{if(t){const i=(0,r.u4)(e,t,s).taskArr,n=`${q.month}-${t}`,c=a[0][n]?"start":"",o=a[1][n]?"end":"";return(0,l.jsxs)("div",{onClick:c||o?u:()=>h([]),"data-time":n,children:[(0,l.jsx)("div",{className:`day ${c} ${o}`,children:(0,l.jsx)("span",{className:"txt",children:t})}),(0,l.jsx)("div",{className:"sign-box",children:(0,l.jsx)("div",{className:"tip",children:i.map(((e,s)=>(0,l.jsx)("span",{className:e?"item":"item none"},s)))})})]})}return null},j=t=>{const a=t.currentTarget;i.current.style.top=a.offsetTop-50+"px",i.current.style.left=a.offsetLeft-20+"px";const n=(0,r.u4)(e,+a.dataset.val,s);o([...n.taskArr,+n.play])},g=["预计开始","预计结束"];return(0,l.jsxs)("div",{className:"month-view-box",children:[(0,l.jsx)("div",{className:"event-box",style:{display:d.length?"block":"none"},children:d.map(((e,s)=>(0,l.jsxs)("div",{className:"tip-box",children:[(0,l.jsxs)("div",{className:"title",children:[(0,l.jsx)("span",{children:g[s]}),(0,l.jsx)("span",{className:"close",onClick:()=>h([]),children:(0,l.jsx)(n.SvgIcon,{className:"close"})})]}),(0,l.jsx)("div",{className:"list",children:e.map(((e,s)=>(0,l.jsxs)("div",{className:"task",children:[(0,l.jsxs)("span",{className:"num",children:[s+1,"、"]}),(0,l.jsx)("span",{className:`icon-type ${(0,r.q7)(e.id,e.type)}`,children:(0,l.jsx)(n.SvgIcon,{className:(0,r.q7)(e.id,e.type)})}),(0,l.jsxs)("span",{className:"txt",children:[" ",e.tit]})]},e.path)))})]},s)))}),(0,l.jsx)("div",{className:"m-hover-tip",style:{display:c.length?"block":"none"},ref:i,children:(0,l.jsxs)("div",{className:"wrap",children:[(0,l.jsx)("div",{className:"time",children:c[4]}),(0,l.jsx)("div",{className:"tip",children:c.slice(0,4).map(((e,s)=>(0,l.jsx)("span",{className:"item",children:e},s)))})]})}),(0,l.jsxs)("table",{className:"mon-tab",onMouseLeave:()=>{o([])},children:[(0,l.jsx)("thead",{children:(0,l.jsx)("tr",{className:"week-head",children:["一","二","三","四","五","六","日"].map((e=>(0,l.jsx)("th",{children:e},e)))})}),(0,l.jsx)("tbody",{children:m.map(((s,t)=>(0,l.jsx)("tr",{className:"week",children:s.map(((s,t)=>(0,l.jsx)("td",{onMouseEnter:s?j:void 0,"data-val":s,className:e===q.month&&s===q.day?"today":"",children:x(s,p)},s||`@${t}`)))},`${e}-${t}`)))})]})]})};const E=n.timeFn.getCurTime();var M=function(e){return e[e.normal=0]="normal",e[e.actualS=1]="actualS",e[e.actualE=2]="actualE",e[e.forcastS=3]="forcastS",e[e.forcastE=4]="forcastE",e[e.start=5]="start",e[e.end=6]="end",e[e.empty=7]="empty",e[e.over=8]="over",e[e.today=9]="today",e}(M||{});const B=64,R=24;var J=({nodeIdArr:e,log:s})=>{const t=(0,a.useRef)(null),[i,c]=(0,a.useState)(0),o=(0,a.useMemo)((()=>{if(!e)return[[],0];const{idArr:t}=e;let a=[],i=0;const l=t.join(",");let c=0;for(const e in s){const t=s[e],i={id:e,playTime:(0,r.KX)(t.timeInfo),order:c+1};t.task.some((e=>e.children?e.children.some((e=>e.id.includes(l))):e.id.includes(l)))&&a.push(i)&&c++}i=a.length,a.shift();const{node:{forecast:o,actual:d,lastTime:h}}=e,m=h.split("-");return o[1]=o[1]||`${+m[0]+1}-${m[1]}`,d[0]||o[0]?(((e,s)=>{const t=s.length;if(t&&(0,r.bJ)(s[s.length-1].id)>=(0,r.bJ)(e[1]))return;const a=t?s[t-1].id:e[0];let i=(0,r.w0)(a,e[1]);i>0&&(i=Math.floor(3*i/5),i&&new Array(i).fill("").map(((e,t)=>{const a=M[M.empty];s.push({id:`${a}-${t}`,type:M.empty,order:t+1})})))})([o[0]||d[0],o[1]],a),[...d,...o].map(((e,s)=>{e&&((e,s,t)=>{const a=`${M[t]}@${s}`;if(t===M.forcastS)e.unshift({id:a,type:M.forcastS,time:s});else{const i=(0,r.bJ)(s);let n=-1,l=e.findIndex(((e,s)=>{if(e.type===M.empty&&t!==M.forcastE)return!0;const a=e.type?e.time:e.id,l=(0,r.bJ)(a);return n=l==i?s:-1,l>=i}));if(n>-1?t===M.actualE?e.splice(l+1,0,{id:a,type:t,time:s}):(t===M.actualS||l++,e.splice(l,0,{id:a,type:t,time:s})):-1==l?e.push({id:a,type:t,time:s}):e.splice(l,0,{id:a,type:t,time:s}),t===M.forcastE&&-1!==l&&e[e.length-1].type!==M.forcastE)for(let s=l+1;s<e.length;s++)e[s].type||(e[s].type=M.over,e[s].time=e[s].id);if(t===M.forcastE){const t=`${E.month}-${E.day}`,a=(0,r.bJ)(t);if((0,r.bJ)(s)<a)return;let i=e.findIndex((e=>{if(e.type===M.empty)return!0;const s=e.type?e.time:e.id;return(0,r.bJ)(s)>=a}));e.splice(i,0,{id:"today",type:M.today,time:t})}}})(a,e,s+1)})),a.unshift({id:"start",type:M.start}),!d[1]&&a[a.length-1].type!==M.forcastE&&a.push({id:"end",type:M.end})):n.notice.add("请添加预计日期！","warn"),[a,i]}),[e]);(0,a.useEffect)((()=>{c(t.current.clientWidth)}),[]);const{data:d,addWidth:h,rowInfo:{count:m,turnCount:p,turnIndex:u}}=(()=>{if(!i)return{data:[{position:{},node:{id:"",playTime:""}}],rowInfo:{count:0,turnIndex:0,turnCount:0},addWidth:-1};let e=0,s=0,t=0,a=-1,n=i<700?9:i<850?11:14,r=1,l=3,c=-10;const d=1.6;let h=n*d;const[m]=o,p=m.length;let u=0;return{data:m.map(((o,m)=>{const x={};if(m<2)x.left=0===m?.15*i-10:48;else{if(u=m+1-l,1===r&&0===u?(c=60*e+32-10,c+=p-1===m?20:0,e%2?(x.right=-10,o.pos="midRight"):(x.left=-10,o.pos="midLeft"),r=n,l+=r,a=0,e++):(h-=d,c=60*e-10,e%2?(x.right=(1.6-u)*R+h*R,o.pos="arrLeft"):(x.left=(1.6-u)*R+h*R,o.pos="arrRight"),0===u&&(r=1,h=n*d,l+=r),a=i-(x.left||x.right||0)-R),!s&&o.type===M.empty){s=m;let a=0;o.pos.includes("mid")||(a=null!=x.right?i/2>x.right?1:0:i/2<x.left?0:1),t=e+a}}return x.top=c,{position:x,node:o}})),rowInfo:{count:e,turnIndex:s,turnCount:t},addWidth:a}})();let x="";return(0,l.jsx)("div",{className:"life-box",children:(0,l.jsx)(n.ScrollBox,{children:(0,l.jsx)("div",{className:"list",children:(0,l.jsxs)("div",{className:"wrap",ref:t,style:{height:B*m||200},children:[e?(0,l.jsxs)("div",{className:"title",children:[(0,l.jsx)("span",{className:"task-name",children:e.text.join("-")}),(0,l.jsxs)("span",{className:"day-tip",children:["学",o[1],"天"]})]}):null,(0,l.jsx)("div",{className:"rows",children:new Array(m).fill("").map(((e,s)=>{const t={};t.top=s*B-4*s,s%2&&(t.right=0);let a=s===m-1&&h>-1?{width:h,right:t.right}:void 0;const n=u&&s>=p?"dashed":"";let r=["",{borderStyle:"solid"}],c=!1;if(u&&s===p-1){var o;const e=d[u];let n=0;var x,j;if(null!==(o=e.node.pos)&&void 0!==o&&o.includes("mid"))c=!0;else if(void 0!==t.right)if(null!==(x=e.node.pos)&&void 0!==x&&x.includes("Left"))r[1].width=i/2-e.position.right,r[1].left=0,r[0]="addLine",n=e.position.right;else{c=!0;const s=i-e.position.left;r[1].width=a?a.width-s:i/2-s,r[1].left=0,r[1].bottom=0,r[1].borderStyle="dashed",r[0]="addLine",a={width:s,right:0,borderStyle:"solid"}}else if(null!==(j=e.node.pos)&&void 0!==j&&j.includes("Left")){c=!0;const s=i-e.position.right;r[1].width=a?a.width-s:i/2-s,a?r[1].left=s:r[1].right=0,r[1].bottom=0,r[1].borderStyle="dashed",r[0]="addLine",a={width:s,left:0,borderStyle:"solid"}}else{const s=e.position.left;r[1].width=i/2-s,r[1].right=0,r[1].top=0,r[0]="addLine",n=s}return(0,l.jsxs)("div",{className:"item dashed",style:t,children:[r[0].includes("addLine")?(0,l.jsx)("div",{className:r[0],style:r[1]}):null,(0,l.jsx)("div",{className:"before",style:c?{borderStyle:"solid"}:{width:n,right:t.right}}),(0,l.jsx)("div",{className:"after",style:a})]},s)}return(0,l.jsxs)("div",{className:`item ${n}`,style:t,"data-key":s,children:[(0,l.jsx)("div",{className:"before"}),(0,l.jsx)("div",{className:"after",style:a})]},s)}))}),(0,l.jsx)("div",{className:"circle-box",children:d.map((e=>{let s=e.node.type?e.node.time||"":e.node.id;const t=s?s.split("-")[0]:"";let a=!1;return t!==x&&(x=t,a=!0),e.node.type&&e.node.type!==M.over&&(a=!0),(0,l.jsxs)("div",{onClick:()=>{},style:e.position,className:`sign ${e.node.pos||""}`,children:[(0,l.jsx)("div",{className:"sign-tip "+(a?"show":"hide"),children:s}),(0,l.jsx)("div",{className:`circle ${e.node.type?M[e.node.type]:""}`,children:e.node.type==M.end?(0,l.jsx)("span",{className:"my-loading",children:(0,l.jsxs)("svg",{width:"100",height:"100",children:[(0,l.jsx)("circle",{className:"mouth",cx:"50",cy:"50",r:"14"}),(0,l.jsx)("circle",{className:"eye",cx:"50",cy:"50",r:"14"})]})}):e.node.order||""})]},e.node.id)}))}),d.length?null:(0,l.jsx)(n.Empty,{})]})})},m)})},L=t("./src/js/globalConst.ts");const z=n.timeFn.getCurTime();let W=function(e){return e[e.normal=0]="normal",e[e.today=1]="today",e[e.event=2]="event",e[e.oneStep=3]="oneStep",e[e.twoStep=4]="twoStep",e[e.threeStep=5]="threeStep",e[e.fourStep=6]="fourStep",e[e.exam=7]="exam",e}({});const V=[{type:W.oneStep,tit:"一阶段",remark:"抓紧基础知识的学习",time:"2-4"},{type:W.exam,tit:"真题模考",remark:"开始用历年真题模考，检查知识点",time:"3-18"},{type:W.oneStep,tit:"数学基础完",remark:"汤1800高数、概率、线代基础篇完",time:"4-15"},{type:W.oneStep,tit:"英语阅读完",remark:"新东方阅读基础100篇完",time:"4-28"},{type:W.twoStep,tit:"二阶段",time:"5-1",remark:"抓紧政治与计算机，数学进阶、英语作文"},{type:W.twoStep,tit:"政治选择题完",time:"5-26",remark:"曲艺甄选完"},{type:W.twoStep,tit:"计算机习题完",time:"6-20",remark:"天勤计算机课后习题"},{type:W.exam,tit:"期中考",time:"7-1"},{type:W.threeStep,tit:"三阶段",remark:"不断开始检查知识点,每半个月模拟考",time:"8-1"},{type:W.threeStep,tit:"测验",remark:"模拟测验",time:"8-19"},{type:W.exam,tit:"摸底考",time:"9-1"},{type:W.event,tit:"报名开始",time:"9-28"},{type:W.fourStep,tit:"冲刺阶段",time:"11-1"},{type:W.exam,tit:"冲刺考",time:"11-15"},{type:W.exam,tit:"决战日",time:"12-23"},{type:W.today,tit:"今天",time:`${z.month}-${z.day}`}],G=[5,5,2,3.25,2,1.5,1.25,1],K=n.timeFn.getCurTime(),_=[["forecastS","预开"],["forecastE","预结"],["actualS","实开"],["actualE","实结"]];var Q=({subjectIndex:e,course:s})=>{const t=(0,a.useRef)(null),i=(0,a.useRef)(null),[c,o]=(0,a.useState)(50),[d,h]=(0,a.useState)(2),[m,p]=(0,a.useState)(e<0),u=(0,a.useMemo)((()=>{const t=[];let a=new Array(12).fill("").map((()=>[]));const i=(e,s)=>{e.map((e=>{const{children:a,tit:n,progress:r,sum:l,path:c,id:o}=e,h=c.split(",").length,m=s+(s?",":"")+n,p=["forecast,0","forecast,1","actual,0","actual,1"][d].split(","),u=e[p[0]][+p[1]],x={path:c,progressStr:`${r}/${l}`,tit:m,time:u,fileType:e.type,id:o};a.length?h>3?u&&t.push(x):i(a,m):u&&t.push(x)}))},n=m?s:s[e].children,l=m?"":s[e].tit;i(n,l),t.concat(V).map((e=>{const{time:s}=e,t=+s.split("-")[0]-1;a[t].push(e);const i=(0,r.w0)(`${K.month}-${K.day}`,s);e.distance=i}));let c=0;const o=[];a=a.map((e=>{o.push(c);const s=e.length;return s?(e=e.sort(((e,s)=>+e.time.split("-")[1]-+s.time.split("-")[1]))).map(((t,a)=>{let i;if(0==a)i=c+20;else{const s=+e[a-1].time.split("-")[1],t=+e[a].time.split("-")[1];i=c+2*Math.round(t-s)+23}return c=i,t.top=c,a===s-1&&(c+=20),t})):c+=40,e}));const h=[],p=a.flat().filter((e=>(e.type&&h.push(e),!e.type))),u=a[11].length?a[11][0].top+20:o[11]+40;return{normal:p,special:h,rule:o,maxH:u}}),[s,d,m,e]);(0,a.useEffect)((()=>{t.current.scrollMethods.initScroll();const e=i.current,s=e.parentElement.clientWidth,a=e.children[2],n=e.children[3];a.style.setProperty("--lineW",`${Math.floor(.35*s-36)}px`),n.style.setProperty("--lineW",`${Math.floor(.65*s-54)}px`),o(s)}),[s,m,d,e]);const x=u.special.find((e=>e.type===W.today)).top+10;return(0,l.jsxs)("div",{className:"progress-box",children:[(0,l.jsx)("div",{className:"head-box",children:(0,l.jsxs)("div",{className:"wrap",children:[(0,l.jsx)("div",{className:"all-box",children:_.map(((e,s)=>(0,l.jsxs)("div",{className:"item",onClick:()=>{h(s)},children:[(0,l.jsx)("div",{className:"bottom"}),(0,l.jsx)("div",{className:"line"}),(0,l.jsx)("div",{className:"head "+(d===s?"active":""),children:e[1]}),(0,l.jsx)("div",{className:"icon-wrap",children:(0,l.jsx)("span",{className:e[0]})})]},e[0])))}),(0,l.jsxs)("div",{className:"theme",children:[(0,l.jsx)("span",{className:"rest",onClick:()=>p((s=>e>-1?!s:s)),children:(0,l.jsx)(n.SvgIcon,{className:"all",size:"middle"})}),(0,l.jsx)("span",{className:"tit",children:m?"全部":s[e].tit})]})]})}),(0,l.jsx)("div",{className:"list",children:(0,l.jsx)(n.ScrollBox,{ref:t,children:(0,l.jsx)("div",{className:"list-wrap",children:(0,l.jsxs)("div",{className:"inner",ref:i,style:{height:u.maxH},children:[(0,l.jsx)("div",{className:"has",style:{height:x}}),(0,l.jsx)("div",{className:"rule-list",children:u.rule.map(((e,s)=>(0,l.jsxs)("div",{className:"rule",style:{top:e},children:[(0,l.jsx)("span",{className:"point"}),(0,l.jsx)("span",{className:"txt",children:s+1}),(0,l.jsx)("span",{className:"point"})]},s)))}),(0,l.jsx)("div",{className:"special-box",children:u.special.map((e=>{const{top:s,time:t,tit:a,distance:i,remark:n}=e;return(0,l.jsx)("div",{className:`item ${W[e.type]}`,style:{top:s},children:(0,l.jsxs)("div",{className:"flag",children:[(0,l.jsx)("span",{className:"triangle",children:(0,l.jsx)("span",{className:"distance",children:i})}),(0,l.jsx)("span",{className:"line",style:{width:.35*c-42-10*G[e.type]}}),(0,l.jsx)("span",{className:"point"}),(0,l.jsx)("span",{className:"tit",children:a}),(0,l.jsxs)("div",{className:"txt-box",children:[(0,l.jsx)("span",{children:a}),(0,l.jsx)("span",{className:"remark",children:n}),(0,l.jsx)("span",{className:"time",children:t})]})]})},t)}))}),(0,l.jsx)("div",{className:"subject-box",children:u.normal.map((({path:e,top:s,progressStr:t,tit:a,time:i,distance:o,fileType:d,remark:h,id:m})=>{const p=t.split("/"),u=Math.floor((1-Math.abs(+p[0])/(+p[1]||1))*(.65*c*.4)),x=a.split(","),j=e.split(","),g=(0,r.q7)(m,d);return(0,l.jsx)("div",{className:`item ${L.rB[+j[0]]}`,style:{top:s},children:(0,l.jsxs)("div",{className:"flag",children:[(0,l.jsx)("span",{className:"point"}),(0,l.jsx)("span",{className:"line",style:{width:.65*c-60-u*[1,1.1,1.1,1.25][+j[0]]}}),(0,l.jsx)("span",{className:"triangle",children:(0,l.jsx)("span",{className:"distance",children:o})}),(0,l.jsxs)("span",{className:"tit",children:[(0,l.jsx)("span",{className:`icon-type ${g}`,children:(0,l.jsx)(n.SvgIcon,{className:g})}),(0,l.jsx)("span",{className:"tit-name",children:x[x.length-1]})]}),(0,l.jsxs)("div",{className:"txt-box",children:[(0,l.jsxs)("span",{children:[x[x.length-2],"-",x[x.length-1]]}),(0,l.jsx)("span",{className:"remark",children:h}),(0,l.jsx)("span",{className:"time",children:i})]})]})},e)}))})]})})})})]})};const X=()=>(0,l.jsxs)("div",{className:"example",children:[(0,l.jsx)("span",{className:"txt",children:"说明："}),(0,l.jsx)("span",{className:"num-item miss_",children:"遗漏"}),(0,l.jsx)("span",{className:"num-item ahead_",children:"完成"}),(0,l.jsx)("span",{className:"num-item only",children:"错一点/典型"}),(0,l.jsx)("span",{className:"num-item none",children:"错一半/重点"}),(0,l.jsx)("span",{className:"num-item sign",children:"全错/难点"}),(0,l.jsx)("span",{className:"num-item star-example",children:"典型"})]});function U(e,s,t){const i=()=>{let a=[];const i=Math.floor(+e.progress),n=e.info;if(t)a=new Array(t).fill(s<=i-1?"finish":"");else if(!n){const s=new Array(i).fill("finish");a=s.concat(new Array(e.sum-i).fill(""))}if(n){const{error:r,half:l,chapterCode:c,miss:o,ahead:d}=n[s],h=r?r.split(","):[],m=l?l.split(","):[],p=c?c.split(","):[],u=o?o.split(","):[],x=d?d.split(","):[];let j=t?s<i?t:0:i;const g=t||e.sum;h.concat(m,p,x).map((e=>{e&&Number(e)>=j&&j--})),j=j<0?0:j;const f=new Array(j).fill("finish");a=f.concat(new Array(g-j).fill("")),h.map((e=>{a[+e]="error"})),m.map((e=>{a[+e]="half"})),p.map((e=>{a[+e]="one"})),u.map((e=>{a[+e]="miss"})),x.map((e=>{a[+e]="ahead"}))}return a},[n,r]=(0,a.useState)(i),l=()=>{let t=[];const a=e.info;if(a){const{star:e}=a[s];(e?e.split(","):[]).map((e=>{t[+e]="star"}))}return t},[c,o]=(0,a.useState)(l);return(0,a.useEffect)((()=>{r(i),o(l)}),[e,s]),{data:n,fn:s=>{const t=s.currentTarget.dataset.id;let a=n[+t];const i=e.progress-1>=+t;a="error"===a?"half":"half"===a?"one":"one"===a?i?"miss":"ahead":"miss"===a?"finish":"ahead"==a?"":"error",r((e=>(e[+t]=a,e.concat())))},fn2:e=>{e.preventDefault();const s=e.currentTarget.dataset.id;let t=c[+s];t="star"===t?"":"star",o((e=>(e[+s]=t,e.concat())))},starData:c}}const Y=({node:e})=>{const s=U(e,0),t=e.sum>40&&e.progress-e.sum/2>2?"reverse":"";return(0,l.jsxs)("div",{className:"num-box",children:[(0,l.jsx)(X,{}),(0,l.jsx)("div",{className:`num-list ${t}`,children:(0,l.jsx)(ee,{data:s,start:0})})]})},ee=({data:{data:e,fn:s,fn2:t,starData:a},children:i,start:n,end:r})=>(0,l.jsxs)(l.Fragment,{children:[i,e.slice(n,r).map(((e,i)=>(0,l.jsx)("span",{className:`num-item ${e} ${a[i]||""}`,"data-id":i+n,onContextMenu:t,onClick:s,children:n+i+1},i)))]}),se=({node:e,order:s})=>{const t=U(e,s,48),{fn:a}=t;return(0,l.jsxs)("div",{className:"test-box",children:[(0,l.jsx)(X,{}),(0,l.jsx)("p",{className:"tit",children:"Section Ⅰ"}),(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)(ee,{data:t,start:0,end:20})}),(0,l.jsx)("p",{className:"tit",children:"Section Ⅱ"}),(0,l.jsxs)("div",{className:"flex-around",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"tit-sub",children:"Part A"}),(0,l.jsx)("div",{children:["1","2","3","4"].map(((e,s)=>(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)(ee,{data:t,end:25+5*s,start:5*s+20,children:(0,l.jsxs)("span",{className:"tit-name",children:["Text ",e]})})},e)))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"tit-sub",children:"Part B"}),(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)(ee,{data:t,end:45,start:40})})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"tit",children:"Section Ⅲ Translation"}),(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)("span",{className:`num-item ${t.data[45]}`,"data-id":45,onClick:a,children:"46"})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"tit",children:"Section Ⅳ Writing"}),(0,l.jsxs)("div",{className:"flex-around",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"tit-sub",children:"Part A "}),(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)("span",{className:`num-item ${t.data[46]}`,"data-id":46,onClick:a,children:"47"})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"tit-sub",children:"Part B "}),(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)("span",{className:`num-item ${t.data[47]}`,"data-id":47,onClick:a,children:"48"})})]})]})]})]})]})},te=({node:e,order:s})=>{const t=U(e,s,23);return(0,l.jsxs)("div",{className:"",children:[(0,l.jsx)("p",{className:"tit",children:"选择题"}),(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)(ee,{data:t,end:8,start:0})}),(0,l.jsx)("p",{className:"tit",children:"填空题"}),(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)(ee,{data:t,start:8,end:14})}),(0,l.jsx)("p",{className:"tit",children:"解答题"}),(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)(ee,{data:t,start:14,end:23})})]})},ae=({node:e,order:s})=>{const t=U(e,s,38);return(0,l.jsxs)("div",{className:"",children:[(0,l.jsx)("p",{className:"tit",children:"选择题"}),(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)(ee,{data:t,start:0,end:16})}),(0,l.jsx)("p",{className:"tit",children:"多选题"}),(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)(ee,{data:t,start:16,end:33})}),(0,l.jsx)("p",{className:"tit",children:"材料题"}),(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)(ee,{data:t,start:33,end:38})})]})},ie=({node:e,order:s})=>{const t=U(e,s,47);return(0,l.jsxs)("div",{className:"",children:[(0,l.jsx)("p",{className:"tit",children:"选择题"}),(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)(ee,{data:t,start:0,end:40})}),(0,l.jsx)("p",{className:"tit",children:"综合应用题"}),(0,l.jsx)("div",{className:"num-list",children:(0,l.jsx)(ee,{data:t,start:40,end:47})})]})},ne=({subjectId:e,node:s,order:t})=>"101"==e?(0,l.jsx)(ae,{node:s,order:t}):"204"===e?(0,l.jsx)(se,{node:s,order:t}):"301"===e?(0,l.jsx)(te,{node:s,order:t}):(0,l.jsx)(ie,{order:t,node:s}),re=({node:e,getData:s,noEdit:t})=>{const i={ahead:0,star:"",chapterCode:""};e.info&&e.info[0]&&(i.chapterCode=e.info[0].chapterCode,i.ahead=Number(e.info[0].ahead||0),i.star=e.info[0].star||"");const r=()=>{const s=i.chapterCode?i.chapterCode.split(","):[];return new Array(+e.sum).fill("").map(((e,t)=>s[t]||"0/0"))},[c,o]=(0,a.useState)(r),d=(0,a.useMemo)((()=>{const s=e.info?e.info[0].chapterCode.split(","):[];return new Array(+e.sum).fill("").map(((e,t)=>{if(s[t]){const e=s[t].split("/");return!("0"==e[0]||e[0]!=e[1])}return!1}))}),[e]);(0,a.useEffect)((()=>{o(r)}),[e]);const h=i.star?i.star.split(","):[],m=e=>{const s=e.currentTarget,t=+s.name,a="total"===s.dataset.set?1:0;let i=s.value;o((e=>{const s=e[t].split("/");return s[a]=i,e[t]=s.join("/"),e.concat()}))},p=e=>{const s=e.currentTarget,t=+s.name,a="total"===s.dataset.set?1:0;let n=s.value;const r=+c[t].split("/")[1],l=0===t?i.ahead:+c[t-1].split("/")[1];n=0==a?Math.min(Math.max(+n,l),r).toString():n,o((e=>{const s=e[t].split("/");return s[a]=n,e[t]=s.join("/"),e.concat()}))};s((()=>({str:c.join(",")})));const u=e=>{const s=e.currentTarget;s.classList.contains("star")?s.classList.remove("star"):s.classList.add("star")},x=i.chapterCode.split(",").reduce(((e,s)=>{const t=s.split("/");return+t[0]>0&&t[0]==t[1]&&e++,e}),0),j=e.progress>3&&x-e.sum/2>0?"reverse":"";return(0,l.jsx)("div",{className:`chapter-list ${j}`,children:new Array(+e.sum).fill("").map(((e,s)=>{const a=(c[s]||"0/0").split("/"),r=0===s?i.ahead:c[s-1]?+c[s-1].split("/")[1]:0;let o=30+2*Math.ceil(+a[1]-r);const x=+a[0]?o*((+a[0]-r)/(+a[1]-r)):0;return(0,l.jsxs)("div",{className:"chapter",children:[(0,l.jsxs)("div",{className:"chapter-tit "+(h.includes(String(s))?"star":""),"data-id":s,onClick:u,children:["第",s+1,"章"]}),(0,l.jsx)("div",{className:"m-wrap",style:{width:o},children:(0,l.jsx)("div",{className:"m-inner",style:{width:Math.ceil(x)}})}),(0,l.jsxs)("div",{className:"j-edit",children:[(0,l.jsx)("span",{className:"page-nums",children:+a[1]-r}),(0,l.jsx)(n.Input,{width:55,type:"number",disabled:d[s],dataSet:"progress",name:String(s),value:""+ +a[0],changeFn:m,blurFn:p}),(0,l.jsx)("span",{className:"space",children:"/"}),(0,l.jsx)(n.Input,{width:55,type:"number",disabled:t,dataSet:"total",name:String(s),value:a[1],changeFn:m,blurFn:p})]})]},s)}))})};var le=({nodeIdArr:e})=>{const[s,t]=(0,a.useState)(1),[i,c]=(0,a.useState)(!0),[o,d]=(0,a.useState)(e&&e.node.info&&e.node.info[s-1].score||""),h=(0,a.useRef)(null),m=(0,a.useRef)((()=>({})));if((0,a.useLayoutEffect)((()=>{window.setImmediate((()=>{var e;null===(e=h.current)||void 0===e||e.scrollMethods.initScroll()})),c(!0)}),[e]),!e)return(0,l.jsx)("div",{className:"life-box progress-file",children:(0,l.jsx)("div",{className:"empty-box",children:(0,l.jsx)(n.Empty,{})})});const p=e.node.type,u=e.idArr[0],x=s=>{const a=s.currentTarget,i=a.value;if("score"===a.name)d(i);else{const s=+i>e.node.sum?e.node.sum:+i<1?1:+i;t(s),d(e&&e.node.info&&e.node.info[s-1].score||"")}},g=e.node.info&&e.node.info[0]?e.node.info:null,f=[];if(g){const t=g[s-1];"book"!=e.node.type&&"literature"!=e.node.type?(t.error&&f.push(t.error),t.one&&f.push(t.one),t.half&&f.push(t.half)):t.star&&f.push(t.star)}const v=f.length?f.join(",").split(",").length:0;return(0,l.jsx)("div",{className:"life-box progress-file",children:(0,l.jsx)(n.ScrollBox,{ref:h,children:(0,l.jsxs)("div",{className:"wrap",children:[(0,l.jsxs)("div",{className:"title",children:[(0,l.jsxs)("span",{className:"task-name",children:[(0,l.jsx)(n.SvgIcon,{size:"middle",className:(0,r.q7)(e.node.id,e.node.type)}),e.text.join("-"),e.idArr.includes("hobby")?(0,l.jsxs)("span",{className:"progress-txt",children:["次数：",e.node.progress]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("span",{className:"progress-txt",children:[e.node.progress,"/",e.node.sum]}),(0,l.jsxs)("span",{className:"error-num",children:[v,"/",e.node.progress]})]})]}),(0,l.jsx)(n.Button,{handle:()=>{let t={};const a=[...document.querySelectorAll("#listBox .star")].map((e=>+e.dataset.id));if("book"===p||"literature"===p)t={order:0,id:e.idArr.join(","),chapterCode:m.current().str,star:a.join(","),ahead:e.node.info&&e.node.info[0]?e.node.info[0].ahead:""};else{const i=[...document.querySelectorAll("#listBox .error")].map((e=>+e.dataset.id)),n=[...document.querySelectorAll("#listBox .half")].map((e=>+e.dataset.id)),r=[...document.querySelectorAll("#listBox .one")].map((e=>+e.dataset.id)),l=[...document.querySelectorAll("#listBox .miss")].map((e=>+e.dataset.id)),c=[...document.querySelectorAll("#listBox .ahead")].map((e=>+e.dataset.id)),d="test"===p?s-1:0;t={error:i.join(","),half:n.join(","),order:d,id:e.idArr.join(","),star:a.join(","),chapterCode:r.join(","),miss:l.join(","),ahead:c.join(",")},"test"==e.node.type&&(t.score=+o)}j.Z.writeProgress(t).then((()=>{n.notice.add("保存成功！"),n.event.emit("refresh")}))},name:"save",children:"保存"}),"book"===p||"literature"===p?(0,l.jsx)(n.Switch,{change:e=>c(!e.currentTarget.checked),checked:!i}):null]}),"test"===p?(0,l.jsxs)("div",{className:"exam",children:[(0,l.jsxs)("span",{className:"order",children:["第",(0,l.jsx)(n.Input,{name:"order",width:50,type:"number",value:String(s),changeFn:x,norequire:!0}),"套试卷 (共",e.node.sum,"套,已完成",e.node.progress,")"]}),(0,l.jsx)("span",{children:"考试得分："}),(0,l.jsx)("span",{className:"score",children:(0,l.jsx)(n.Input,{name:"score",value:String(o),norequire:!0,width:70,changeFn:x})})]}):(0,l.jsxs)("div",{className:"book-opt",children:[(0,l.jsxs)("div",{className:"tip",children:["第",(0,r.aK)(Number(e.node.again||1)-1),"遍复习"]}),(0,l.jsx)(n.Button,{name:"again",styleType:"line-btn",handle:()=>{const s=e.node.info&&e.node.info[0]?e.node.info[0]:null;if(!s||e.node.progress!=e.node.sum)return void n.notice.add("请完成当前的复习，再进入下一轮！","warn");if(s.chapterCode.split(",").some((e=>"0"==e.split("/")[0])))return void n.notice.add("请完成当前的复习，再进入下一轮！","warn");const t=s.version||[];t[e.node.again?+e.node.again-2:0]=[s.error||"",s.half||"",s.one||""];const a={chapterCode:s.chapterCode.split(",").map((e=>`0/${e.split("/")[1]}`)).join(","),ahead:s.ahead||"",id:e.idArr.join(","),star:s.star,isNext:!0,error:s.error,half:s.half,one:s.one,order:0,version:t};j.Z.writeProgress(a).then((()=>{n.notice.add("下一轮成功！"),n.event.emit("refresh")}))},children:"下一轮"})]}),(0,l.jsx)("div",{className:"list-box",id:"listBox",children:"test"===p?(0,l.jsx)(ne,{node:e.node,order:s-1,subjectId:u}):"book"===p||"literature"===p?(0,l.jsx)(re,{noEdit:i,getData:e=>{m.current=e},node:e.node}):(0,l.jsx)(Y,{node:e.node})})]})})})};const ce=({log:e,nodeIdArr:s})=>{const[t,i]=(0,a.useState)(!0),c=(0,a.useMemo)((()=>{const{idArr:t}=s,a=t.join(","),i=[];for(const s in e){const t=e[s],n=[];t.task.map((e=>{if(e.id.includes(a))n.push(e);else if(e.children){const s=e.children.filter((e=>e.id.includes(a)));s.length&&n.push(Object.assign({},e,{children:s}))}})),n.length&&i.push({id:s,task:n})}return i}),[s]);(0,a.useEffect)((()=>{i(!0)}),[s]);return(0,l.jsxs)("div",{className:"m-item-log",style:{display:t?"flex":"none"},children:[(0,l.jsxs)("div",{className:"title",children:[s.text.join("-")," ",c.length," 天",(0,l.jsx)("span",{className:"j-close",onClick:()=>{i(!1)},children:(0,l.jsx)(n.SvgIcon,{className:"close",size:"big"})})]}),(0,l.jsx)("div",{className:"item-box",children:c.map((({id:e,task:s},t)=>(0,l.jsxs)("div",{className:"item-log",children:[(0,l.jsxs)("div",{className:"log-time",children:[(0,l.jsx)("span",{className:"order",children:t+1}),e]}),(0,l.jsx)("div",{className:"task",children:s.map((e=>{var s,t,a;return(0,l.jsxs)("div",{className:"task-item",children:[(0,l.jsxs)("div",{className:"item-name",children:[(0,l.jsxs)("span",{className:"item-icon",children:[" ",(0,l.jsx)(n.SvgIcon,{className:(a=e.children?e.children[0]:e,(0,r.q7)(a.id,a.type)),size:"big"})]}),e.txt.split("-").slice(1).join("-"),(0,l.jsx)("span",{className:"progress",children:e.children?"":`${e.progress.join("/")}`})]}),(0,l.jsxs)("div",{className:"child-box",children:[e.taskStartTime?(0,l.jsx)("p",{className:"remark",children:null===(s=e.taskStartTime[(0,r.lq)(e.id)||(0,r.LT)(e.type)?3:2])||void 0===s?void 0:s.trim()}):"",null===(t=e.children)||void 0===t?void 0:t.map(((e,s)=>{var t;return(0,l.jsxs)("div",{className:"child-item",children:[(0,l.jsxs)("p",{children:[s+1,"、",e.txt," ",(0,l.jsx)("span",{className:"progress",children:e.progress.join("/")})]}),(0,l.jsx)("p",{className:"remark",children:null===(t=e.taskStartTime[(0,r.lq)(e.id)||(0,r.LT)(e.type)?3:2])||void 0===t?void 0:t.trim()})]},e.id)}))]})]},e.id)}))})]},e)))})]})},oe=n.timeFn.getCurTime(),de=({changeWeek:e,lastWeek:s})=>{const t=t=>{const a=t.currentTarget.dataset.type;let i=s+-1*("pre"===a?1:-1);i=i<=0?0:i,e(i)};return(0,l.jsxs)("div",{className:"time-opt",children:[(0,l.jsx)("span",{className:"opt",onClick:t,"data-type":"pre",children:(0,l.jsx)(n.SvgIcon,{className:"arrow-pre"})}),(0,l.jsx)(n.Input,{width:30,value:String(s),changeFn:s=>{let t=s.currentTarget.value.trim();if(!t.match(/^\d+$/))return void n.notice.add("填入数字");let a=Number(t);a=a<=0?0:a,e(a)}}),(0,l.jsx)("span",{className:"opt",onClick:t,"data-type":"next",children:(0,l.jsx)(n.SvgIcon,{className:"arrow-next"})})]})},he=new Array(oe.month).fill(0).map(((e,s)=>({id:oe.month-s,text:oe.month-s}))),me=({logs:e,courseData:s})=>{const[t,i]=(0,a.useState)(oe.month),[c,o]=(0,a.useState)(0),[d,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)(!1),[u,x]=(0,a.useState)(),j=Math.floor(10*Math.random())%3;return(0,a.useEffect)((()=>{window.setTimeout((()=>{p(!0)}),1e3)}),[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"chart-box",children:[(0,l.jsx)(n.Modal,{field:"tip",show:m,tit:"学习方法",className:"tip-modal",toggleFn:(e,s)=>p(s),children:(0,l.jsxs)("div",{className:"flex-center",children:[(0,l.jsx)("div",{className:"effect",children:(0,l.jsx)("img",{className:"tip-img",src:"./assert/imgs/main/effect.png",alt:""})}),(0,l.jsxs)("div",{className:"memory",children:[(0,l.jsx)("img",{className:"tip-img",src:"./assert/imgs/main/forget.png",alt:""}),(0,l.jsx)("img",{className:"tip-img",src:"./assert/imgs/main/remerber.png",alt:""})]})]})}),(0,l.jsx)(P,{}),(0,l.jsx)(F,{logs:e,lastWeek:c}),(0,l.jsxs)("div",{className:"center-opt-box",children:[(0,l.jsx)(n.Combobox,{field:"mon",width:60,noSearch:!0,data:he,defaultVal:`${oe.month}`,clickCallback:e=>i(+e[0].id)}),(0,l.jsx)(de,{lastWeek:c,changeWeek:e=>{o(e)}}),(0,l.jsxs)("div",{className:"tip",children:[(0,l.jsx)("span",{className:"item",children:"204"}),(0,l.jsx)("span",{className:"item",children:"301"}),(0,l.jsx)("span",{className:"item",children:"408"}),(0,l.jsx)("span",{className:"item",children:"101"})]})]}),(0,l.jsx)(Z,{logs:e[0],month:t,course:s}),u?(0,l.jsx)(ce,{nodeIdArr:u,log:e[0]}):null]}),(0,l.jsxs)("div",{className:"right-layout",children:[d?(0,l.jsx)(le,{nodeIdArr:u}):(0,l.jsx)(J,{log:e[0],nodeIdArr:u||(s.length?(0,r.Fz)(s,String(j)):void 0)}),(0,l.jsx)(b,{subjectData:s,selectSubject:(e,s)=>{x(e),h(!!s)}})]}),(0,l.jsx)(Q,{course:s.slice(0,4),subjectIndex:u?+u.node.path.split(",")[0]:-1})]})},pe=[60,100,100,60];class ue extends a.PureComponent{constructor(...e){super(...e),(0,i.Z)(this,"state",{selectType:"crankily",subjectType:"test",data:{infoObj:{maxTask:[],crankily:[],failed:[],pass:[],low:[],none:[]},obj:[]}}),(0,i.Z)(this,"chartPieRef",(0,a.createRef)()),(0,i.Z)(this,"chartInstance",null),(0,i.Z)(this,"selectFn",(e=>{const s=e.currentTarget.dataset.id;this.setState({selectType:s})})),(0,i.Z)(this,"selectSubkectFn",(e=>{const s=e.currentTarget.dataset.id;this.setState({subjectType:s})}))}componentDidMount(){const e=this.getConsistDay();this.setState({data:e}),this.chartInstance=f.S1(this.chartPieRef.current),this.chartInstance.setOption(this.getPieChartData(e))}componentDidUpdate(e){if(e.log!==this.props.log||e.course!==this.props.course){const e=this.getConsistDay();this.setState({data:e}),this.chartInstance.setOption(this.getPieChartData(e))}}getAllExam(){const{course:e}=this.props,s=[],t=[],a=(e,i)=>{e.map((e=>{const n=`${i}${i?",":""}${e.id}`;e.children.length?a(e.children,n):"test"===e.type&&(s.push(n),t.push(e))}))};return a(e,""),{idSArr:s,nodeArr:t}}getConsistDay(){const{log:e}=this.props,s=L.q6.map((e=>({id:e,sign:0,test:[],start:"",lastTime:["1-1",0],arr:[],two:[],four:[],maxScore:0,total:0,noQualified:[]}))),t={maxTask:[],crankily:[],low:[],failed:[],pass:[],none:[]};if(!e["1-1"])return{obj:s,infoObj:t};const{idSArr:a,nodeArr:i}=this.getAllExam(),n=(0,r.q3)(r.K4.today),l=n.length;n.map(((c,o)=>{const d=e[c];if(d&&d.remark.length>120&&t.crankily.push(c),d&&d.task.length){d.task.reduce(((e,s)=>(0,r.lq)(s.id)?e+1:e),0)>5&&t.maxTask.push(c);(0,r.fM)(d.task).includes("study")&&t.none.push(c),d.task.map((e=>{const n=a.indexOf(e.id);if(n>-1){const a=e.id.split(","),r=L.q6.indexOf(a[0]),l=i[n],o=e.progress[0],d=o-1;if(String(o).includes(".")){const e={score:0,path:l.path,order:d,time:c,txt:l.tit};t.failed.push(e)}else l.progress&&l.info[d]&&s[r].test.push({score:l.info[d].score||0,path:l.path,order:d,time:c,txt:l.tit})}})),s.map((e=>{d.task.some((s=>{const{id:t}=s;return t.split(",")[0]===e.id}))?(e.lastTime[1]=0,e.lastTime[0]=c,0!==e.sign&&e.sign>=2&&e.arr.push({num:e.sign,time:[e.start,n[o-1]]}),e.sign=0,e.total++):(0===e.sign&&(e.start=c),e.sign+=1,e.lastTime[1]++)}))}else s.map((e=>{0===e.sign&&(e.start=c),e.sign+=1,e.lastTime[1]+=1})),t.none.push(c);l===o+1&&s.map((e=>{e.sign>=2&&e.arr.push({num:e.sign,time:[e.start,n[o-1]]})}))})),s.map(((e,s)=>{e.arr.map((s=>{const{num:t}=s;2===t||3===t?e.two.push(s):e.four.push(s)}));let t=0;e.test.map((a=>{a.score<=pe[s]&&e.noQualified.push(a),t=t<a.score?a.score:t}))}));const c=[0,1,2,3].sort(((e,t)=>s[e].test.length-s[t].test.length));return s[c[0]].test.map(((e,a)=>{let i=0;const n=[];L.q6.map(((e,t)=>{const r=s[t].test[a];i+=r.score,n.push(r)})),i<=320&&t.low.push(n),i>=425&&t.pass.push(n)})),{infoObj:t,obj:s}}getConsistent(e){const{subjectType:s}=this.state,t=["test","two","four","noQualified"];return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("table",{className:"analyse-tab",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"head",children:[(0,l.jsx)("th",{}),L.RJ.map((e=>(0,l.jsx)("th",{style:{width:"17%"},children:(0,l.jsx)("div",{className:"subject-name",children:e})},e)))]})}),(0,l.jsx)("tbody",{children:[{name:"模拟测试次数",field:"test"},{name:"不及格次数",field:"noQualified"},{name:"最高分",field:"maxScore"},{name:"离上次学习天数",field:"lastTime"},{name:"连续2-3天没学次数",field:"two"},{name:"连续≥4天没学次数",field:"four"}].map((a=>{const i=a.field;return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"td-border type "+(s===i?"active":""),onClick:t.includes(i)?this.selectSubkectFn:void 0,"data-id":i,children:(0,l.jsx)("span",{children:a.name})}),e.map((e=>{const s=e[i];return(0,l.jsx)("td",{className:"td-border",children:"lastTime"===i?(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"num",children:[s[1],(0,l.jsx)("br",{}),"1-1"===s[0]?"--":s[0]]})}):["maxScore"].includes(i)?(0,l.jsx)("span",{className:"num",children:s}):(0,l.jsx)("span",{className:"num",children:s.length})},e.id)}))]},i)}))})]})})}getInfo(e){const{selectType:s}=this.state;return(0,l.jsx)(l.Fragment,{children:[{id:"maxTask",txt:"任务超过5次的次数"},{id:"crankily",txt:"焦虑想多了的天数"},{id:"low",txt:"总分低于320次数"},{id:"pass",txt:"过线次数"},{id:"failed",txt:"考试失败次数"}].map((({id:t,txt:a})=>(0,l.jsxs)("div",{className:"item "+(t===s?"active":""),"data-id":t,onClick:this.selectFn,children:[(0,l.jsx)("span",{className:"tit",children:a}),(0,l.jsx)("span",{className:"num",children:e[t].length})]},t)))})}getExamBox(){const{obj:e}=this.state.data;if(!e.length)return(0,l.jsx)(l.Fragment,{});const s=[0,1,2,3].sort(((s,t)=>e[t].test.length-e[s].test.length));return(0,l.jsxs)("table",{className:"test-tab",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"subject-tit",children:"总分"}),L.RJ.map((e=>(0,l.jsx)("th",{className:"subject-tit",children:e},e)))]})}),(0,l.jsx)("tbody",{children:e[s[0]].test.map(((s,t)=>{let a=1;const i=L.q6.map(((s,i)=>{const n=e[i].test[t],r=n?n.score:0;return a&&n?a+=r:a=0,(0,l.jsx)("td",{children:r||"--"},s)}));return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"num",children:a||"--"}),i]},t)}))})]})}getPieChartData(e){const{infoObj:s,obj:t}=e,a=t.map(((e,s)=>({value:e.total,name:L.RJ[s][0]}))),i=a.concat({name:"无",value:s.none.length});return{color:["#5470C6","#91CC75","#FACE6C","#EE6666","#F1F2F8"],title:{text:"学习天数",left:10,top:6,textStyle:{color:"blue"}},series:[{name:"学习天数",type:"pie",radius:["35%","65%"],center:["50%","50%"],roseType:"area",itemStyle:{borderRadius:8},data:a,labline:{length:3,length2:3},label:{formatter:"{b}-{c}",textStyle:{fontSize:14,fontWeight:"bold",color:"#0002A1"}}},{name:"时间占比",type:"pie",radius:["12%","24%"],center:["50%","50%"],itemStyle:{borderRadius:8},data:i,labline:{show:!0},label:{position:"center",textStyle:{fontWeight:"bold"}}}]}}render(){const{data:e}=this.state,{obj:s,infoObj:t}=e;return(0,l.jsxs)("div",{className:"analyse-text",children:[(0,l.jsxs)("div",{className:"top-box ",children:[(0,l.jsx)("div",{className:"consistent-box",children:this.getConsistent(s)}),(0,l.jsx)("div",{className:"info-box",children:this.getInfo(t)})]}),(0,l.jsxs)("div",{className:"right-box",children:[(0,l.jsx)("div",{className:"detail-box",children:this.getExamBox()}),(0,l.jsx)("div",{className:"pie-box",children:(0,l.jsx)("div",{className:"chart",ref:this.chartPieRef})})]})]})}}var xe=ue;class je extends a.PureComponent{constructor(...e){super(...e),(0,i.Z)(this,"state",{selectType:0,timeover:[]}),(0,i.Z)(this,"boxRef",(0,a.createRef)()),(0,i.Z)(this,"chartInstance",null),(0,i.Z)(this,"selectTimeType",(e=>{const s=+e.currentTarget.dataset.id,t=(0,r.q3)(s);this.setState({selectType:s,timeover:[t[0],t[t.length-1]]},(()=>{this.init(t)}))}))}componentDidMount(){this.chartInstance=f.S1(this.boxRef.current);const e=(0,r.q3)(this.state.selectType);this.setState({timeover:[e[0],e[e.length-1]]},(()=>{this.init(e)}))}getChartData(e){const{logs:s}=this.props,t=s.map((()=>({301:0,101:0,408:0,204:0,home:0,sport:0,status:0,go:0,4:0,none:0,2:0})));return e.map((e=>{s.map(((a,i)=>{const n=a[e],l={301:0,101:0,408:0,204:0};if(n){var c;n.task.map((e=>{const s=e.id.split(",");l[s[0]]++}));const a=t[i];Object.keys(l).map((e=>{l[e]&&a[e]++}));const o=0==i?Number((0,r.KX)(n.timeInfo)):n.palyTime;o>=2&&o<4&&a[2]++,o>=4&&a[4]++;const d=s[0][e]?(0,r.fM)(s[0][e].task):[];(0==i?d.includes("atHome"):n.atHome)&&a.home++,(0==i?d.includes("study"):n.task.length)||a.none++,1==i?(d.includes("void")&&a.sport++,d.includes("eat")&&a.go++):(d.includes("sport")&&a.sport++,d.includes("play")&&a.go++);const h=null===(c=s[0][e])||void 0===c?void 0:c.status;h&&(0===i?Number(h)>2&&a.status++:!(Number(h)>2)&&a.status++)}}))})),t}init(e){this.chartInstance.setOption(this.createChart(e))}componentDidUpdate(e){if(e.logs!==this.props.logs){const e=(0,r.q3)(this.state.selectType);this.init(e)}}createChart(e){const s={301:["#285430","#7D8F69"],204:["#753422","#D79771"],408:["#1FAB89","#9DF3C4"],101:["#FFA45B","#FFDA77"],4:["#282A3A","#6B728E"],none:["#DC0000","#FD8A8A"],home:["#0081C9","#5BC0F8"],sport:["#0d0cb5","#913175"],status:["#D9ACF5","#ffe194"],go:["#579BB1","#4E6C50"],2:["#3BACB6","#82DBD8"]},t={301:"数",101:"政",408:"计",204:"英",home:"家",sport:"精",go:"饭",status:"力",4:"废",none:"无",2:"贪"},a=this.getChartData(e),i=[],n=a.map(((e,a)=>({type:"bar",itemStyle:{borderRadius:[8,8,0,0]},data:Object.keys(e).map(((n,r)=>{const l={value:e[n],itemStyle:{color:s[n][a]}};return i[r]={value:t[n],textStyle:{color:s[n][0],fontSize:15}},l})),label:{show:!0,position:"top"},name:["终战","一战"][a]})));return{xAxis:{data:i,show:!0,type:"category"},legend:{show:!1},tooltip:{show:!0,trigger:"axis",axisPointer:{type:"shadow"}},yAxis:[{type:"value",name:"天数",nameLocation:"end",nameTextStyle:{color:"blue",fontSize:12,padding:[0,30,0,0]},nameGap:10}],grid:{bottom:28,top:30,left:30,right:10},series:n}}render(){const{selectType:e,timeover:s}=this.state;return(0,l.jsxs)("div",{className:"analyse-chart",children:[(0,l.jsxs)("div",{className:"wrap",children:[(0,l.jsx)("div",{className:"type-box",children:["至今","周","月","全部"].map(((s,t)=>(0,l.jsx)("div",{className:`time-item ${r.K4[t]} ${t===e?"active":""}`,"data-id":t,onClick:this.selectTimeType,children:(0,l.jsx)("span",{children:s})},s)))}),(0,l.jsx)("div",{className:"time-over",children:s.join(" ~ ")})]}),(0,l.jsx)("div",{className:"chart",ref:this.boxRef})]})}}var ge=je,fe=t("./node_modules/immutable/dist/immutable.es.js");var ve=({node:e,slide:s,slideFn:t,initScroll:i,oindex:r,changeFn:c,getCurProgress:o})=>{const{children:d,tit:h,lastTime:m,path:p}=e,u=d.length,x=(0,a.useMemo)((()=>{const e=[],s=[];let t=!1;return d[0].children[0].children.length?(s.push("知识点"),t=!0,d[0].children[0].children.map((e=>{s.push(e.tit)}))):(t=!1,d[0].children.map((e=>{s.push(e.tit)}))),u>4?d.map(((a,i)=>{if(t)a.children.map(((n,r)=>{const l=e.push({name:`${i+1}、`+a.tit,id:n.parId,"col-0":`${r+1}.${n.tit}`}),c={};n.children.map((e=>{c[e.tit]=e})),s.slice(t?1:0).map(((s,a)=>{const i=`col-${a+(t?1:0)}`;e[l-1][i]=c[s]?[Object.assign({},c[s],{tit:""})]:[]}))}));else{const n=e.push({name:`${i+1}、`+a.tit,id:a.parId}),r={};a.children.map((e=>{r[e.tit]=e})),s.slice(t?1:0).map(((s,a)=>{const i=`col-${a+(t?1:0)}`;e[n-1][i]=r[s]?[Object.assign({},r[s],{tit:""})]:[]}))}})):d.map(((t,a)=>{t.children.map(((i,n)=>{const r=e.push({name:`${a+1}、`+t.tit,"col-0":`${n+1}.${i.tit}`}),l={};i.children.map((e=>{l[e.tit]=e})),s.slice(1).map(((s,t)=>{const a=`col-${t+1}`;e[r-1][a]=l[s]?[Object.assign({},l[s],{tit:""})]:[]}))}))})),{head:s,arr:e}}),[e]),j=(0,a.useCallback)(((e,s,t,a)=>{const i=e.toJS()[a];return(0,l.jsx)("div",{className:"cell-box",children:"string"==typeof i?i:i.map(((e,s)=>(0,l.jsx)(Ne,{getCurProgress:o,node:e,changeFn:c,oindex:s},e.path)))})}),[o]),g=x.head.map(((e,s)=>(0,l.jsx)(n.Table.colItem,{formatter:j,field:`col-${s}`,width:"知识点"==e?void 0:"23%",children:e},e)));return g.unshift((0,l.jsx)(n.Table.colItem,{field:"name",isRowSpanField:!0,children:"章节"})),(0,l.jsxs)("div",{className:"tab",children:[(0,l.jsxs)("div",{className:"tit-sub slide-handle",onClick:t,"data-id":p,children:[(0,l.jsx)("span",{className:"num",children:r+1}),(0,l.jsx)("span",{className:"tit",children:h}),(0,l.jsxs)("span",{className:"forecast",children:["上次时间：",m]}),(0,l.jsx)("span",{className:"arrow-icon",children:(0,l.jsx)(n.SvgIcon,{className:s?"arrow-down":"arrow-up"})})]}),(0,l.jsx)(n.SlideBox,{slide:s,slideFnCallback:i,children:(0,l.jsx)(n.Table,{height:u>5?400:300,data:x.arr,idField:"id",noPageNums:!0,canSelectField:"name",noOrder:!0,autoHeight:!0,children:g})})]})};const Ne=({node:{type:e,progress:s,sum:t,tit:a,path:i,parId:c,again:o,id:d},oindex:h,changeFn:m,getCurProgress:p,sub:u})=>{const x=i,j=p(x)||String(s),g=Number(j)-s,f=!(0,r.lq)(c),v=i.split(",").length;return(0,l.jsxs)("div",{className:"item-sub",children:[(0,l.jsxs)("span",{className:`tit${u?"-"+u:""} ${g?"has-change":""}`,children:[(0,l.jsxs)("span",{className:"num",children:[h+1,v>4?".":v<4?"、":""]}),o&&"literature"!==e?(0,l.jsx)("span",{className:"again",children:(0,r.K)(+o-1)}):null,v<4?(0,l.jsxs)("span",{className:"tit-icon",children:[" ",(0,l.jsx)(n.SvgIcon,{className:(0,r.q7)(d,e)})]}):void 0,f?"":(0,l.jsxs)("span",{className:"txt",children:[a,(0,l.jsxs)("span",{className:"progress-tip",children:["(",Number(Number(s).toFixed(2)),"/",t,")"]})]})]}),f?(0,l.jsx)(n.CheckBox,{disabled:!!o,type:"checkbox",checked:!!p(i),changeHandle:m,value:`${x}@${s},${t}`,name:"events",children:(0,l.jsxs)("span",{className:g?"active-item":"",children:[a,(0,l.jsxs)("span",{className:"progress-tip",children:["(",Number(s.toFixed(1)),")"]})]})}):(0,l.jsx)(n.Input,{value:j,norequire:!0,disabled:!(!t||s!=t),name:"progress",changeFn:m,dataSet:`${x}@${s},${t}`,type:"number"})]})},ye=({node:e,changeFn:s,slideFn:t,oindex:i,slide:c,getCurProgress:o,initScroll:d,defaultSlideId:h})=>{const{tit:m,children:p,path:u,type:x,id:j}=e,[g,f]=(0,a.useState)(h?h.split("@"):[]),v=e=>{const s=e.currentTarget.dataset.id;f((e=>e.includes(s)?e.filter((e=>e!==s)):e.concat(s)))};let N=x,y=e;for(;!N&&y;)y=y.children[0],N=y.type;return(0,l.jsxs)("div",{className:"all",children:[(0,l.jsxs)("div",{className:"tit slide-handle",onClick:t,"data-id":u,children:[(0,l.jsxs)("span",{children:[i+1,"、",(0,l.jsx)("span",{className:"tit-icon",children:(0,l.jsx)(n.SvgIcon,{className:(0,r.q7)(j,N)})}),m]}),(0,l.jsxs)("span",{className:"forecast",children:["上次时间：",e.lastTime]}),(0,l.jsx)("span",{className:"arrow-icon",children:(0,l.jsx)(n.SvgIcon,{className:c?"arrow-down":"arrow-up"})})]}),(0,l.jsx)(n.SlideBox,{slide:c,slideFnCallback:d,children:(0,l.jsx)("div",{className:"item-sub-list",children:p.map(((e,t)=>{if(e.children.length){if(e.children[0].children.length){const a=o(),i=a&&a.includes(e.path)?e=>o(e):o;return(0,l.jsx)(ve,{getCurProgress:i,node:e,slideFn:v,initScroll:d,changeFn:s,oindex:t,slide:g.includes(e.path)},e.path)}{const a=g.includes(e.path);return(0,l.jsxs)("div",{className:"all",children:[(0,l.jsxs)("div",{className:"tit-sub slide-handle","data-id":e.path,onClick:v,children:[(0,l.jsxs)("span",{children:[(0,l.jsx)("span",{className:"num",children:t+1}),(0,l.jsx)("span",{children:e.tit}),(0,l.jsxs)("span",{className:"forecast",children:["上次时间：",e.lastTime]})]}),(0,l.jsx)("span",{className:"arrow-icon",children:(0,l.jsx)(n.SvgIcon,{className:a?"arrow-down":"arrow-up"})})]}),(0,l.jsx)(n.SlideBox,{slide:a,slideFnCallback:d,children:(0,l.jsx)("div",{className:"stage-item",children:e.children.map(((e,t)=>(0,l.jsx)(Ne,{getCurProgress:o,node:e,changeFn:s,oindex:t},e.path)))})})]},e.path)}}return(0,l.jsx)(Ne,{getCurProgress:o,node:e,sub:"sub",changeFn:s,oindex:t},e.path)}))})})]})};var be=({data:e,selectStage:s,changeFn:t,getCurProgress:i,initScroll:r,defaultOneLevSlideIdStr:c,defaultTwoLevSlideIdStr:o})=>{const[d,h]=(0,a.useState)(c?c.split("@"):[]),m=e.children,p=e=>{const s=e.currentTarget.dataset.id;h((e=>e.includes(s)?e.filter((e=>e!==s)):e.concat(s)))},u=s.map((e=>(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"theme-tit",children:[(0,l.jsxs)("span",{children:[" ",m[+e].tit]}),(0,l.jsxs)("span",{className:"forecast",children:["上次时间：",m[+e].lastTime]})]}),(0,l.jsx)("div",{className:"stage-item",children:m[Number(e)].children.map(((e,s)=>{const{children:a}=e;return a&&a.length?(0,l.jsx)(ye,{defaultSlideId:o,slide:d.includes(e.path),slideFn:p,getCurProgress:i,node:e,initScroll:r,changeFn:t,oindex:s},e.path):(0,l.jsx)(Ne,{getCurProgress:i,node:e,changeFn:t,oindex:s},e.path)}))})]},e)));return(0,l.jsxs)("div",{className:"subject",children:[(0,l.jsxs)("div",{className:"theme",children:[(0,l.jsx)("span",{children:e.tit}),(0,l.jsxs)("span",{className:"forecast",children:["上次时间：",e.lastTime]})]}),(0,l.jsxs)("div",{className:"stage",children:[(0,l.jsx)("div",{className:"subject-lists",children:m.map(((a,i)=>(0,l.jsxs)(n.Switch,{tit:"开,关",value:`${e.id},${i}`,name:"stage",checked:s.includes(String(i)),change:t,children:[a.id.split("-")[1]?`${a.id.split("-")[1]}.`:"",a.tit,"(",a.children.length,")"]},a.path)))}),(0,l.jsx)("div",{className:"stage-content",children:u})]})]})};const Se=[{id:"overwork",text:"劳累"},{id:"pain",text:"疼痛"},{id:"codeHeart",text:"编码"},{id:"sad",text:"悲伤"},{id:"full",text:"充实"},{id:"happy",text:"开心"},{id:"sick",text:"生病"},{id:"embarrassed",text:"尬尴"},{id:"exhaustion",text:"懵昏"},{id:"tired",text:"疲惫"},{id:"studying",text:"认真学习"},{id:"wallow",text:"沉迷摆烂"},{id:"phoneWaster",text:"刷手机"}],ke=({node:e,changeInp:s})=>{const t=!(0,r.lq)(e.id),a=e.id.split(",").pop();if(!t||(0,r.LT)(e.type)){const a=["morning","afternoon","night"],i=e.add!==Number(e.taskNum.reduce(((e,s)=>e+Number(s)),0).toFixed(2)),c=e.taskNum.map(((c,o)=>(0,l.jsxs)("div",{className:`${i&&!t?"no-fill":""} ${a[o]}`,children:[(0,r.LT)(e.type)?null:(0,l.jsx)(n.Input,{value:String(c||""),matchValFn:()=>i,type:"number",width:60,placeholder:"数量",changeFn:s,name:"taskNum",dataSet:`${e.path}@${o}`}),(0,l.jsxs)("div",{className:"inp-box",children:[(0,l.jsx)(n.Input,{value:String(e.taskStartTime[o]||""),width:50,matchValFn:(e,s)=>!(!s||/^\d{1,2}:\d{1,2}$/.test(s)),placeholder:"开始",changeFn:s,name:"start",dataSet:`${e.path}@${o}`}),(0,l.jsx)(n.Input,{value:String(e.taskHour[o]||""),matchValFn:()=>!e.id.includes("void")&&"000"===e.taskHour.join(""),type:"number",placeholder:"耗时",width:50,changeFn:s,name:"hourVal",dataSet:`${e.path}@${o}`})]})]},o)));return(0,l.jsxs)("td",{children:[(0,l.jsx)("div",{className:"flex-center",children:c}),(0,l.jsx)("div",{children:(0,l.jsx)(n.Textarea,{value:String(e.taskStartTime[3]||""),placeholder:"记录",norequire:!0,changeFn:s,name:"start",dataSet:`${e.path}@3`})})]})}if((0,r.wH)(a))return(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"inp-box",children:[(0,l.jsx)(n.Input,{value:String(e.taskHour[0]||""),placeholder:"数量",width:80,changeFn:s,name:"hourVal",dataSet:`${e.path}@0`}),(0,l.jsx)(n.Textarea,{value:String(e.taskStartTime[0]||""),placeholder:"记录",norequire:!0,changeFn:s,name:"start",dataSet:`${e.path}@0`})]})});if((0,r.FJ)(a))return(0,l.jsx)("td",{children:(0,l.jsx)(n.Textarea,{value:String(e.taskStartTime[0]||""),placeholder:"记录",norequire:!0,changeFn:s,name:"start",dataSet:`${e.path}@0`})});{const t=(0,r.zf)(e.id)||(0,r.EG)(e.type)||["开始","耗时","记录2","耗时"];return(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"inp-box",children:[(0,l.jsx)(n.Input,{value:String(e.taskStartTime[0]||""),width:80,norequire:!0,placeholder:t[0],changeFn:s,name:"start",dataSet:`${e.path}@0`}),(0,l.jsx)("span",{children:":"}),(0,l.jsx)(n.Input,{value:String(e.taskHour[0]||""),placeholder:t[1],norequire:!0,width:80,type:"number",changeFn:s,name:"hourVal",dataSet:`${e.path}@0`}),(0,l.jsx)(n.Input,{value:String(e.taskStartTime[1]||""),placeholder:t[2],norequire:!0,width:80,changeFn:s,name:"start",dataSet:`${e.path}@1`}),(0,l.jsx)("span",{children:":"}),(0,l.jsx)(n.Input,{value:String(e.taskHour[1]||""),placeholder:t[3],norequire:!0,width:80,type:"number",changeFn:s,name:"hourVal",dataSet:`${e.path}@1`}),(0,l.jsx)(n.Textarea,{value:String(e.taskStartTime[2]||""),placeholder:"备注",norequire:!0,changeFn:s,name:"start",dataSet:`${e.path}@2`})]})})}},we=({node:e,index:s,parIndex:t,parNode:a,changeInp:i,remove:c})=>{const o=a||e,d=!(0,r.lq)(e.id),h=(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("span",{className:"progress",children:[(0,l.jsxs)("span",{className:"tit",children:[" ",d?e.progress[0]:e.progress.join("/")]}),(0,l.jsxs)("span",{className:"add",children:["[",e.add,"]"]})]}),(0,l.jsx)("span",{className:"close",onClick:c,"data-path":e.path,children:(0,l.jsx)(n.SvgIcon,{className:"close"})})]});let m=o.type,p=o;for(;!m&&p;)p=p.children[0],m=p.type;const u=(0,r.q7)(o.id,m),x=(0,l.jsx)("td",{className:"main-td",rowSpan:a?a.children.length:void 0,colSpan:a?void 0:2,children:(0,l.jsxs)("div",{className:"subject-item",children:[(0,l.jsx)("span",{className:"sub-num",children:a?t+1:s+1}),o.again?(0,l.jsx)("span",{className:"again",children:(0,r.aK)(+o.again-1)}):null,(0,l.jsx)("span",{className:`icon-type ${u}`,children:(0,l.jsx)(n.SvgIcon,{className:u})}),(0,l.jsx)("span",{className:"item-name",children:o.txt.split("-").slice(1).join("-")}),a?null:h]})});return(0,l.jsxs)("tr",{"data-id":e.id,children:[a?0===s?x:void 0:x,a?(0,l.jsxs)("td",{children:[(0,l.jsxs)("span",{className:"order",children:[s+1,"、"]}),e.again?(0,l.jsx)("span",{className:"again",children:(0,r.aK)(+e.again-1)}):null,(0,l.jsx)("span",{children:e.txt}),h]}):void 0,(0,l.jsx)(ke,{node:e,changeInp:i})]})},Te=({changeInp:e,changeStatus:s,saveFn:t,getLog:i,logObj:c,remove:o})=>{const d=(0,a.useMemo)((()=>i(c,!0)),[i,c]),{task:h,timeInfo:m,remark:p,status:u}=d;let x="";const j=h.reduce(((e,s)=>["101","204","301","408"].includes(s.id.slice(0,3))?(s.children?e+=s.children.reduce(((e,s)=>e+s.taskHour.reduce(((e,s)=>e+Number(s)),0)),0):e+=s.taskHour.reduce(((e,s)=>e+Number(s)),0),e):e),0),g=h.reduce(((e,s)=>["badHabit"].includes(s.id.split(",")[0])?e+=s.taskHour.reduce(((e,s)=>e+Number(s)),0):e),0),f=h.reduce(((e,s)=>{var t;return["work"].includes(s.id.split(",")[0])?(null!==(t=s.children)&&void 0!==t&&t.length?s.children.map((s=>{e+=s.taskHour.reduce(((e,s)=>e+Number(s)),0)})):e+=s.taskHour.reduce(((e,s)=>e+Number(s)),0),e):e}),0);return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"remark",children:(0,l.jsx)(n.Textarea,{value:p,name:"remark",norequire:!0,placeholder:"备注",changeFn:e})}),(0,l.jsxs)("div",{className:"log",children:[(0,l.jsx)("div",{className:"status-combox",children:(0,l.jsx)(n.Combobox,{tit:"状态",noRequire:!0,ableClear:!0,defaultVal:u,width:80,maxHeight:600,dropWidth:90,data:Se,formatterVal:e=>{var s;return(0,l.jsx)("span",{children:(0,l.jsx)(n.SvgIcon,{className:(null===(s=e.get(0))||void 0===s?void 0:s.id)||"",size:"big"})})},formatterDropItem:e=>(0,l.jsx)(n.SvgIcon,{className:e.get("id"),size:"big"},e.get("id")),field:"status",noSearch:!0,clickCallback:s},u)}),(0,l.jsxs)("span",{className:"erergy-box",children:[" ",(0,l.jsx)(n.SvgIcon,{className:j<2?"energy-0":j<6?"energy-15":j<9?"energy-55":j<12?"energy-80":"energy",size:"big"})," "]}),(0,l.jsxs)("span",{className:"hour study",children:["学: ",j.toFixed(1)]}),(0,l.jsxs)("span",{className:"hour work",children:["工: ",f.toFixed(1)]}),(0,l.jsxs)("span",{className:"hour waster",children:["废: ",g.toFixed(1)]}),m.slice(0,3).map(((s,t)=>(0,l.jsx)(n.Input,{name:"timeInfo",type:"number",changeFn:e,norequire:!0,value:String(s||""),dataSet:String(t),children:["早","中","晚"][t]},t))),(0,l.jsxs)("div",{className:"btn-box",children:[(0,l.jsx)(n.Button,{handle:t,name:"save",children:"保存"})," ",(0,l.jsx)(n.Button,{handle:t,name:"rest",styleType:"line-btn",children:"重置"})]})]}),(0,l.jsxs)("table",{className:"taskInfo-tab",children:[(0,l.jsxs)("colgroup",{children:[(0,l.jsx)("col",{width:"22%"}),(0,l.jsx)("col",{width:"30%"}),(0,l.jsx)("col",{width:"48%"})]}),(0,l.jsx)("tbody",{children:h.map(((s,t)=>{const{children:i,id:n,txt:c}=s;let d,m;const p=n.split(",");if(p[0]!==x){let e=0;h.slice(t).some((s=>{if(s.id.split(",")[0]!=p[0])return!0;s.children?s.children.map((s=>{e+=(0,r.xI)(s.taskHour,{id:s.id,type:s.type})})):e+=(0,r.xI)(s.taskHour,{id:s.id,type:s.type})})),m=(0,l.jsx)("tr",{className:"theme",children:(0,l.jsxs)("td",{colSpan:3,children:[c.split("-")[0],":共用时：",Number(e.toFixed(1))," h"]})}),x=p[0]}else m=null;return d=i?i.map(((a,i)=>(0,l.jsx)(we,{remove:o,node:a,index:i,changeInp:e,parIndex:t,parNode:s},a.id))):(0,l.jsx)(we,{remove:o,changeInp:e,node:s,index:t}),(0,l.jsxs)(a.Fragment,{children:[m,d]},s.id)}))})]})]})},Ce=n.timeFn.getCurTime(),Ie={remark:"",status:"",timeInfo:["","","",""],progress:{},taskHour:{},taskStartTime:{}};class Fe extends a.PureComponent{constructor(...e){super(...e),(0,i.Z)(this,"state",{taskConfig:fe.fromJS(Ie),subject:fe.fromJS({101:[],408:[],204:[],301:[],work:[],health:[],life:[],family:[],badHabit:[],hobby:[]}),data:[],log:{},setTime:"",hideSave:!1,dayTime:fe.fromJS([]),food:fe.fromJS([])}),(0,i.Z)(this,"scrollboxRef",(0,a.createRef)()),(0,i.Z)(this,"slideIdStrArrObj",{one:[],two:[]}),(0,i.Z)(this,"isChangingPath",""),(0,i.Z)(this,"initScroll",(()=>{var e;null===(e=this.scrollboxRef.current.scrollMethods)||void 0===e||e.initScroll()})),(0,i.Z)(this,"getCurProgress",(e=>e?this.state.taskConfig.getIn(["progress",e,3]):this.isChangingPath)),(0,i.Z)(this,"changeFn",(e=>{const s=e.currentTarget,t=s.value,a=s.name;if("stage"===a){const e=s.checked,a=t.split(",");this.setState((s=>({subject:s.subject.updateIn([a[0]],(s=>{let t=s;return e?t.push(a[1]):t.filter((e=>e!=a[1]))}))})),(()=>{this.initScroll()}))}else if("progress"===a){const e=s.dataset.set.split("@"),a=e[1].split(","),i=Number(t)>Number(a[1])?a[1]:t;this.setState((s=>{let t=s.taskConfig.getIn(["progress",e[0]]);const n=(new Date).getHours(),r=n<13?0:n<19?1:2;if(t){const e=t.toJS().slice(0,3).reduce(((e,s,t)=>r!==t?e+=Number(s):e),0),s=+i-+a[0]-e;t=t.set(r,Number(s.toFixed(2))).set(3,+i)}else{const e=[0,0,0,+i];e[r]=+i,t=fe.fromJS(e)}let l=s.taskConfig.getIn(["taskHour",e[0]]),c=s.taskConfig.getIn(["taskStartTime",e[0]]);return l||(l=fe.fromJS([0,0,0])),c||(c=fe.fromJS(["","",""])),this.isChangingPath=e[0],{taskConfig:s.taskConfig.setIn(["progress",e[0]],t).setIn(["taskHour",e[0]],l).setIn(["taskStartTime",e[0]],c)}}))}else if("remark"===a||"timeInfo"===a){const e=s.dataset.set,i="remark"===a?[a]:[a,e];this.setState((e=>({taskConfig:e.taskConfig.setIn(i,t)})))}else if("taskNum"===a){const e=s.dataset.set.split("@");this.setState((s=>({taskConfig:s.taskConfig.setIn(["progress",e[0],e[1]],+t)})))}else if("events"===a){const e=s.value.split("@"),t=e[1].split(","),a=this.state.taskConfig.getIn(["progress",e[0]]),i=(new Date).getHours(),n=i<13?0:i<19?1:2,r=[0,0,0,+t[0]+1];r[n]=1,this.setState((s=>({taskConfig:a?s.taskConfig.deleteIn(["progress",e[0]]).deleteIn(["taskHour",e[0]]).deleteIn(["taskStartTime",e[0]]):s.taskConfig.setIn(["progress",e[0]],fe.fromJS(r)).setIn(["taskHour",e[0]],fe.fromJS([0,0,0])).setIn(["taskStartTime",e[0]],fe.fromJS(["","",""]))})))}else if("hourVal"===a){const e=s.dataset.set.split("@");this.setState((s=>({taskConfig:s.taskConfig.setIn(["taskHour",e[0],e[1]],+t)})))}else if("start"===a){const e=s.dataset.set.split("@");this.setState((s=>({taskConfig:s.taskConfig.setIn(["taskStartTime",e[0],e[1]],t)}))),"5,3,5@0"==s.dataset.set&&this.setState((e=>({dayTime:e.dayTime.setIn([1],t)})))}})),(0,i.Z)(this,"getLog",((e,s)=>{const{remark:t,timeInfo:a,status:i}=e.toJS(),n=this.getChangeTaskArr().flat();s||n.map((e=>(delete e.path,e.children&&(e.children=e.children.map((e=>(delete e.path,e)))),e)));const r=n.reduce(((e,s)=>{var t;return["work"].includes(s.id.split(",")[0])?(null!==(t=s.children)&&void 0!==t&&t.length?s.children.map((s=>{e+=s.taskHour.reduce(((e,s)=>e+Number(s)),0)})):e+=s.taskHour.reduce(((e,s)=>e+Number(s)),0),e):e}),0);a[3]=String(r.toFixed(1));const l={id:`${Ce.month}-${Ce.day-0}`,remark:t,timeInfo:a,task:n,status:i,dayTime:this.state.dayTime.toJS(),food:this.state.food.toJS()};return i||delete l.status,l})),(0,i.Z)(this,"save",(e=>{if("rest"===e.currentTarget.name)return this.getData(!0),void this.setState({setTime:"",hideSave:!1});if(this.state.hideSave)return void n.notice.add("现在获取的数据不是当前时间！","warn");if(document.querySelectorAll("#changeBox .no-fill").length)return void n.notice.add("时间有问题！","warn");const s=this.getLog(this.state.taskConfig);j.Z.writeLog(s).then((()=>{n.notice.add("保存成功！"),n.event.emit("refresh")}))})),(0,i.Z)(this,"remvoe",(e=>{const s=e.currentTarget.dataset.path;this.setState((e=>({taskConfig:e.taskConfig.deleteIn(["progress",s])})))})),(0,i.Z)(this,"relaod",(e=>{const s=e.currentTarget.name,{setTime:t}=this.state;if(/^\d{1,2}-\d{1,2}/.test(t)){if("reload"==s)this.getData(!0,t),this.setState({hideSave:!0});else if("log"==s){if(document.querySelectorAll("#changeBox .no-fill").length)return void n.notice.add("时间有问题！","warn");delete this.getLog(this.state.taskConfig).id}}else n.notice.add("时间有误!","error")})),(0,i.Z)(this,"changeDayTime",(e=>{const s=e.currentTarget,t=+s.name;this.setState((e=>({dayTime:e.dayTime.setIn([t],s.value)})))})),(0,i.Z)(this,"changeStatus",(e=>{this.setState((s=>{var t;return{taskConfig:s.taskConfig.set("status",(null===(t=e[0])||void 0===t?void 0:t.id)||"")}}))})),(0,i.Z)(this,"slectFood",((e,s)=>{const t=s.split("-")[1],a=e.map((e=>e.id)).join(",");this.setState((e=>({food:e.food.setIn([t],a)})))}))}componentDidMount(){this.getData(!0)}restoreProgerss(e,s){e.progress=s.progress[0]-s.add;const t=((0,r.Em)(s.id,s.type)?[s.taskHour[1]]:(0,r.oi)(s.type)?s.taskHour.slice(0,1):s.taskHour).reduce(((e,s)=>e+=Number(s)),0);e.hour=(s.hour?s.hour:0)-t}setSlideArr(e,s,t){const a=+e[0];if(e.length>3){const t=e.slice(0,3).join(",");!s[a].includes(t)&&s[a].push(t)}if(e.length>4){const s=e.slice(0,4).join(",");!t[a].includes(s)&&t[a].push(s)}}setNode(e,s,t,a,i){const n=(0,r.M9)(e,s.id,"tit"),l=n.node,c=n.pathArr,o=c.join(",");this.restoreProgerss(l,s),t.progress[o]=s.taskNum.concat(Number(l.progress+s.add)),s.taskHour||(s.taskHour=[0,0,0]),s.taskStartTime||(s.taskStartTime=["","",""]),t.taskHour[o]=s.taskHour,t.taskStartTime[o]=s.taskStartTime,!a[i].includes(c[1])&&a[i].push(c[1]),this.setSlideArr(c,this.slideIdStrArrObj.one,this.slideIdStrArrObj.two)}restoreData(e,s,t){const a=s[t||`${Ce.month}-${Ce.day-0}`],i={101:[],204:[],301:[],408:[],work:[],life:[],family:[],health:[],badHabit:[],hobby:[]},n={progress:{},taskHour:{},taskStartTime:{},remark:"",status:"",timeInfo:["","","",""]};if(this.slideIdStrArrObj.one=new Array(e.length).fill("").map((()=>[])),this.slideIdStrArrObj.two=new Array(e.length).fill("").map((()=>[])),a&&a.task.length){a.task.map((s=>{const{children:t}=s,a=s.id.split(",")[0];t?t.map((s=>{this.setNode(e,s,n,i,a)})):this.setNode(e,s,n,i,a)}))}return a&&(n.timeInfo=a.timeInfo,n.remark=a.remark,n.status=a.status||""),{data:(0,r.QW)(e),taskConfig:n,subject:i,dayTime:(null==a?void 0:a.dayTime)||["","","",""],food:(null==a?void 0:a.food)||["","",""]}}getData(e=!1,s){Promise.all([j.Z.getDataJson("logs"),j.Z.getDataJson("course"),j.Z.getDataJson("universe")]).then((t=>{const[a,i,n]=t,{taskConfig:l,subject:c}=this.state;let o,d=l,h=c;const m=i.data.concat(n.data);let p=["","","",""],u=["","",""];if(e){const e=this.restoreData(m,a.data,s);d=fe.fromJS(e.taskConfig),o=e.data,h=fe.fromJS(e.subject),p=e.dayTime,u=e.food}else o=(0,r.QW)(m);this.setState({data:o,taskConfig:d,subject:h,log:a.data,dayTime:fe.List(p),food:fe.List(u),initFood:{id:u[1]},initFood2:{id:u[2]}},(()=>{var e;null===(e=this.scrollboxRef.current.scrollMethods)||void 0===e||e.initScroll()}))}))}getChangeTaskArr(){const{taskConfig:e,data:s}=this.state,t=e.get("progress").toJS(),a=e.get("taskHour").toJS(),i=e.get("taskStartTime").toJS(),n={204:"1",301:"2",408:"3",101:"4",life:"5",work:"6",family:"7",health:"8",badHabit:"9"},l={},c=Object.keys(t).map((e=>{const{idArr:n,text:l,node:c}=(0,r.Fz)(s,e),o=c,d=l,h=(0,r.lq)(n.join(",")),m=((0,r.Em)(c.id,c.type)?[a[e][1]]:(0,r.oi)(c.type)?a[e].slice(0,1):a[e]).reduce(((e,s)=>e+=Number(s)),0),p=m+((0,r.wH)(n[n.length-1])||!o.hour?0:o.hour),u=h?+t[e][3]:o.progress+(m>=0?1:-1),x=h?u-o.progress:1,j=String(x).includes("."),g={txt:d,progress:[u,+o.sum],hour:Number(p.toFixed(1)),add:j?+x.toFixed(2):x,id:n,remark:"",type:o.type,path:e,taskHour:a[e],taskStartTime:i[e],taskNum:t[e].slice(0,3)};return o.again&&(g.again=o.again),g})).filter((e=>{const s=0!==e.add;return s&&(l[e.path]=e),s})),o=this.classifyTask(c),d={};return o.map((e=>{const s=e.id.split(","),t=n[s[0]];d[t]=d[t]||[],d[t].push(e)})),Object.values(d)}classifyTask(e){const s=[],t={};e.map((e=>{const{id:a,txt:i,progress:n,add:r,taskNum:l,taskHour:c,hour:o,taskStartTime:d,type:h,again:m}=e,p={id:a.join(","),again:m,txt:i.join("-"),progress:n,taskStartTime:d,add:r,taskHour:c,hour:o,taskNum:l,type:h,path:e.path};if(a.length>4){const s=a.slice(0,4).join(",");t[s]=t[s]||{txt:e.txt.slice(0,4).join("-"),id:a.slice(0,4).join(","),children:[]},p.txt=i.slice(4).join("-"),t[s].children.push(p)}else s.push(p)}));const a=Object.values(t).map((e=>{var s;return e.children=null===(s=e.children)||void 0===s?void 0:s.sort(((e,s)=>{const t=e.path.split(",").slice(4).map((e=>e.padStart(2,"0"))).join(""),a=s.path.split(",").slice(4).map((e=>e.padStart(2,"0"))).join("");return Number(t)-Number(a)})),e}));return s.concat(a)}render(){const{data:e,subject:s,taskConfig:t,setTime:a,dayTime:i,food:c,initFood:o,initFood2:d}=this.state;return(0,l.jsxs)("div",{className:"edit-box ",children:[(0,l.jsx)("div",{className:"item-box course-box",children:(0,l.jsx)(n.ScrollBox,{ref:this.scrollboxRef,children:e.map(((e,t)=>(0,l.jsx)(be,{getCurProgress:this.getCurProgress,changeFn:this.changeFn,selectStage:s.get(e.id),initScroll:this.initScroll,data:e,defaultOneLevSlideIdStr:this.slideIdStrArrObj.one[t].join("@"),defaultTwoLevSlideIdStr:this.slideIdStrArrObj.two[t].join("@")},e.path)))})}),(0,l.jsxs)("div",{className:"item-box time-box",id:"changeBox",children:[(0,l.jsxs)("div",{style:{display:"flex"},className:"m-optBtn",children:[(0,l.jsx)(n.Input,{value:a,width:100,norequire:!0,changeFn:e=>this.setState({setTime:e.currentTarget.value.trim()})}),(0,l.jsx)(n.Button,{name:"reload",handle:this.relaod,children:"获取"}),(0,l.jsx)(n.Button,{name:"log",handle:this.relaod,children:"设置log"}),(0,l.jsx)(n.Input,{value:i.get(0),width:60,name:"0",placeholder:"起床",norequire:!0,changeFn:this.changeDayTime}),(0,l.jsx)(n.Input,{value:i.get(1),name:"1",width:60,placeholder:"午睡",norequire:!0,changeFn:this.changeDayTime}),(0,l.jsx)(n.Input,{value:i.get(2),width:60,name:"2",placeholder:"睡觉",norequire:!0,changeFn:this.changeDayTime}),(0,l.jsx)(n.Input,{value:i.get(3),width:60,name:"3",placeholder:"洗澡",norequire:!0,changeFn:this.changeDayTime}),(0,l.jsxs)("div",{className:"status-combox flex-center",children:[(0,l.jsx)(n.Combobox,{tit:"午餐",formatterVal:e=>{var s;return(0,l.jsx)("span",{children:(0,l.jsx)(n.SvgIcon,{className:(null===(s=e.get(0))||void 0===s?void 0:s.id)||"",size:"big"})})},noRequire:!0,width:80,noSearch:!0,data:r.Wz,clickCallback:this.slectFood,field:"food-1",ableClear:!0,maxHeight:600,initComboVal:o,defaultVal:c.get(1),formatterDropItem:e=>(0,l.jsx)("span",{children:(0,l.jsx)(n.SvgIcon,{className:e.get("id"),size:"big"})})}),(0,l.jsx)(n.Combobox,{tit:"晚餐",formatterVal:e=>{var s;return(0,l.jsx)("span",{children:(0,l.jsx)(n.SvgIcon,{className:(null===(s=e.get(0))||void 0===s?void 0:s.id)||"",size:"big"})})},ableClear:!0,width:80,noSearch:!0,data:r.Wz,clickCallback:this.slectFood,field:"food-2",noRequire:!0,maxHeight:600,initComboVal:d,defaultVal:c.get(2),formatterDropItem:e=>(0,l.jsx)("span",{children:(0,l.jsx)(n.SvgIcon,{className:e.get("id"),size:"big"})})})]})]}),(0,l.jsx)(Te,{remove:this.remvoe,getLog:this.getLog,logObj:t,changeInp:this.changeFn,changeStatus:this.changeStatus,saveFn:this.save})]})]})}}var $e=Fe;var De=()=>{const[e,s]=(0,a.useState)([{},{}]),[t,i]=(0,a.useState)([]);return(0,a.useEffect)((()=>{const e=()=>{Promise.all([j.Z.getDataJson("logs"),j.Z.getDataJson("firstLog"),j.Z.getDataJson("course"),j.Z.getDataJson("universe")]).then((e=>{const[t,a,n,l]=e;s([t.data,a.data]),i((0,r.QW)(n.data.concat(l.data)))}))};return e(),n.event.on("refresh",(()=>{e()})),()=>{n.event.remove("refresh")}}),[]),(0,l.jsx)("div",{className:"home-page",children:(0,l.jsxs)(g.Z5,{children:[(0,l.jsx)(g.AW,{index:!0,element:(0,l.jsx)(me,{logs:e,courseData:t})}),(0,l.jsx)(g.AW,{path:"home/allot",element:(0,l.jsx)($e,{})}),(0,l.jsx)(g.AW,{path:"home/logs",element:(0,l.jsxs)("div",{className:"m-logs",children:[(0,l.jsxs)("div",{className:"sumarize-box",children:[(0,l.jsx)(ge,{logs:e}),(0,l.jsx)(N,{logs:e})]}),(0,l.jsxs)("div",{className:"logs-box",children:[(0,l.jsx)("div",{className:"logs-item logs-tab",children:(0,l.jsx)(x,{logs:e})}),(0,l.jsx)("div",{className:"logs-item",children:(0,l.jsx)(xe,{log:e[0],course:t})})]})]})})]})})}}}]);